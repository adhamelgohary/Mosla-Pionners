<!-- templates/client_portal/pipeline.html -->
{% extends "client_portal/client_base.html" %}

{% block title %}Candidate Pipeline{% endblock %}
{% block page_title %}Candidate Pipeline{% endblock %}

{% block content %}
<div class="space-y-10">
    {% if offers %}
        {% for offer in offers %}
        <div class="bg-white shadow sm:rounded-lg overflow-hidden">
            <div class="bg-gray-50 border-b border-gray-200 px-4 py-4 sm:px-6">
                <h3 class="text-lg font-semibold leading-6 text-gray-900">{{ offer.Title }}</h3>
                <p class="mt-1 text-sm text-gray-500">Shortlisted candidates for this role. ({{ offer.candidates|length }} / {{ offer.CandidatesNeeded }})</p>
            </div>
            <div class="flow-root">
                {% if offer.candidates %}
                <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                    <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
                        <table class="min-w-full divide-y divide-gray-300">
                            <thead>
                                <tr>
                                    <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-0">Candidate Name</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">CV</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
                                    <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 bg-white">
                                {% for candidate in offer.candidates %}
                                <tr>
                                    <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-0">{{ candidate.FirstName }} {{ candidate.LastName }}</td>
                                    <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                        {% if candidate.CVFileUrl %}
                                            <a href="{{ candidate.CVFileUrl }}" target="_blank" class="text-slate-600 hover:text-slate-900 underline">View CV <i class="bi bi-box-arrow-up-right text-xs"></i></a>
                                        {% else %}
                                            No CV
                                        {% endif %}
                                    </td>
                                    <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                        <span class="inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10">{{ candidate.Status }}</span>
                                    </td>
                                    <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">
                                        <form method="POST" action="{{ url_for('client_offers_bp.update_application_status', application_id=candidate.ApplicationID) }}" class="flex items-center space-x-2">
                                            <button type="submit" name="action" value="schedule_interview" class="rounded bg-white px-2 py-1 text-xs font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">Schedule Interview</button>
                                            <button type="submit" name="action" value="reject" class="rounded bg-white px-2 py-1 text-xs font-semibold text-red-600 shadow-sm ring-1 ring-inset ring-red-300 hover:bg-red-50">Reject</button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-8 px-6">
                    <p class="text-sm text-gray-500">No shortlisted candidates for this offer yet.</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="text-center py-10 border rounded-lg">
        <h3 class="mt-2 text-sm font-semibold text-gray-900">No active job offers</h3>
        <p class="mt-1 text-sm text-gray-500">You do not have any open job offers with a candidate pipeline.</p>
        <div class="mt-6">
            <a href="{{ url_for('client_offers_bp.submit_offer') }}" class="inline-flex items-center rounded-md bg-slate-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-600">
              Submit an Offer
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
