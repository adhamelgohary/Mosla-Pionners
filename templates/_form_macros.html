{# templates/_form_macros.html #}

{% macro render_field_with_icon(field, icon_path_d, placeholder="") %}
{# Renders a general input field (text, email, url, tel, number) with an optional leading icon. #}
<div class="input-group">
    {% if icon_path_d %}
    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="{{ icon_path_d }}"></path>
    </svg>
    {% endif %}
    {{ field(placeholder=placeholder or field.label.text, class="form-control" ~ (" is-invalid" if field.errors else "")) }}
    {% if field.errors %}
        <div class="invalid-feedback">
            {% for error in field.errors %}
                <span>{{ error }}</span><br>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endmacro %}
{% macro render_password_field_with_toggle(field, icon_path_d, placeholder="") %}
<div class="input-group password-input-group">
    {% if icon_path_d %}
    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="{{ icon_path_d }}"></path>
    </svg>
    {% endif %}
    {{ field(placeholder=placeholder or field.label.text, class="form-control password-input-field" ~ (" is-invalid" if field.errors else ""), type="password", id=field.id or field.name) }}
    <button type="button" class="password-toggle-icon" data-target="{{ field.id or field.name }}" aria-label="Show password" title="Show password">
        <svg class="eye-icon eye-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
            <circle cx="12" cy="12" r="3" fill="currentColor"/>
            <path fill="currentColor" d="M12,4.5C7,4.5,2.73,7.61,1,12c1.73,4.39,6,7.5,11,7.5s9.27-3.11,11-7.5C21.27,7.61,17,4.5,12,4.5z M12,17c-2.76,0-5-2.24-5-5s2.24-5,5-5s5,2.24,5,5S14.76,17,12,17z"/>
        </svg>
        <svg class="eye-icon eye-slashed" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" style="display: none;">
            <path fill="currentColor" d="M12,7c2.76,0,5,2.24,5,5c0,0.65-0.13,1.26-0.36,1.83l2.92,2.92c1.51-1.26,2.7-2.89,3.44-4.75C21.27,7.61,17,4.5,12,4.5c-1.77,0-3.39,0.59-4.74,1.58l2.92,2.92C10.74,7.13,11.35,7,12,7z M2,4.27l2.28,2.28C3.12,7.86,1.89,9.79,1,12c1.73,4.39,6,7.5,11,7.5c1.55,0,3.03-0.3,4.38-0.84l2.36,2.36L21.19,19.1L3.68,2.71L2,4.27z M7.53,9.8l1.55,1.55C9.03,11.56,9,11.78,9,12c0,1.66,1.34,3,3,3c0.22,0,0.44-0.03,0.65-0.08l1.55,1.55C13.26,16.87,12.65,17,12,17c-2.76,0-5-2.24-5-5C7,10.92,7.19,10.34,7.53,9.8z"/>
        </svg>
    </button>
    {% if field.errors %}
        <div class="invalid-feedback">
            {% for error in field.errors %}
                <span>{{ error }}</span><br>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endmacro %}


{% macro render_select_field_with_icon(field, icon_path_d) %}
{# Renders a select field with an optional leading icon. #}
<div class="input-group">
    {% if icon_path_d %}
    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="{{ icon_path_d }}"></path>
    </svg>
    {% endif %}
    {{ field(class="form-control" ~ (" is-invalid" if field.errors else "")) }}
    {% if field.errors %}
        <div class="invalid-feedback">
            {% for error in field.errors %}
                <span>{{ error }}</span><br>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endmacro %}

{% macro render_textarea_with_icon(field, icon_path_d, placeholder="") %}
{# Renders a textarea with an optional leading icon. #}
<div class="input-group">
    {% if icon_path_d %}
    {# Adjust icon style if needed for textarea alignment, e.g., align-items: flex-start on .input-group #}
    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="top: 18px;"> {# Slightly adjusted top for typical textarea padding #}
        <path d="{{ icon_path_d }}"></path>
    </svg>
    {% endif %}
    {{ field(placeholder=placeholder or field.label.text, class="form-control" ~ (" is-invalid" if field.errors else ""), rows=3) }}
    {% if field.errors %}
        <div class="invalid-feedback">
            {% for error in field.errors %}
                <span>{{ error }}</span><br>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endmacro %}


{% macro render_file_field(field, icon_path_d, default_label_text) %}
{# Renders a styled file input field. The actual input is hidden and a label is styled. #}
<div class="input-group file-upload-group {{ "is-invalid" if field.errors else "" }}"> {# Add is-invalid class to group for border #}
    {% if icon_path_d %}
    <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="{{ icon_path_d }}"></path>
    </svg>
    {% endif %}
    <label for="{{ field.id or field.name }}" id="{{ field.id or field.name }}_label" class="file-upload-label">{{ default_label_text }}</label>
    {{ field(hidden="hidden", id=field.id or field.name, class_="form-control-file") }} {# Ensure id is set, class_ for WTForms #}
    {% if field.errors %}
        <div class="invalid-feedback" style="width: 100%; padding-left: 50px; margin-top: 0.25rem;"> {# Adjust styling for error display #}
            {% for error in field.errors %}
                <span>{{ error }}</span><br>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endmacro %}


{% macro render_checkbox_field(field, label_class="") %}
{# Renders a checkbox field. #}
<label class="{{ label_class }}">
    {{ field(class_="form-check-input" ~ (" is-invalid" if field.errors else "")) }} {# class_ for WTForms #}
    {{ field.label.text }}
</label>
{% if field.errors %}
    <div class="invalid-feedback d-block"> {# d-block might be Bootstrap specific, adjust if needed #}
        {% for error in field.errors %}
            <span>{{ error }}</span><br>
        {% endfor %}
    </div>
{% endif %}
{% endmacro %}

{% macro render_submit_button(field, button_class="login-button") %}
{# Renders a submit button. #}
<div class="input-group"> {# Consistent grouping, though often not needed for submit #}
    {{ field(class=button_class) }}
</div>
{% endmacro %}