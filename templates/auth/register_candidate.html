<!DOCTYPE html>
<html lang="en" {% if session.get('theme') == 'dark' %}data-theme="dark"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - Mosla Pioneers</title>
    <!-- Your original CSS link -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/website/login.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Alpine.js for multi-step form interactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- All your original inline styles are restored here -->
    <style>
        .input-group { position: relative; margin-bottom: 1.5rem; }
        .input-group .icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--icon-color, #9CA3AF); pointer-events: none; }
        .input-group input[type="text"], .input-group input[type="email"], .input-group input[type="password"], .input-group input[type="url"], .input-group input[type="tel"], .input-group select {
            width: 100%; padding: 14px 20px 14px 45px; border: 1px solid var(--input-border, #D0D5DD); border-radius: 8px;
            font-family: 'Poppins', sans-serif; font-size: 1rem; background-color: var(--input-background); color: var(--text-color);
        }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: var(--primary-accent); }
        .input-group input.is-invalid { border-color: #dc3545; }
        .password-input-wrapper { position: relative; }
        .password-toggle-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--icon-color, #9CA3AF); }
        .eye-slashed { display: none; }
        .file-upload-group { display: flex; align-items: center; width: 100%; border: 1px solid var(--input-border, #ccc); border-radius: 8px; padding-left: 12px; transition: border-color 0.3s; margin-bottom: 1.5rem; }
        .file-upload-group:has(input:focus-visible), .file-upload-group:hover { border-color: var(--primary-accent); }
        .file-upload-group .icon { color: var(--icon-color, #9CA3AF); margin-right: 10px; }
        .file-upload-label { flex-grow: 1; padding: 14px 0; cursor: pointer; color: var(--subtle-text-color, #888); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 1rem; }
        body.dark-mode .file-upload-label { color: var(--subtle-text-color, #aaa); }
        .file-upload-label.has-file { color: var(--text-color); }
        .file-upload-group input[type="file"] { display: none; } 
        .file-upload-group.is-invalid { border-color: #dc3545; }

        .alert { padding: .75rem 1.25rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: .25rem; }
        .alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
        .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
        .alert-warning { color: #856404; background-color: #fff3cd; border-color: #ffeeba; }
        .alert-info { color: #0c5460; background-color: #d1ecf1; border-color: #bee5eb; }
        .invalid-feedback { display: block; width: 100%; margin-top: .25rem; font-size: .875em; color: #dc3545; }
        
        [x-cloak] { display: none !important; }
    </style>
</head>
<body {% if session.get('theme') == 'dark' %}class="dark-mode"{% endif %}>
    <nav>
        <button id="theme-toggle" class="theme-toggle-button" aria-label="Toggle theme">
            <!-- Theme toggle SVGs -->
        </button>
    </nav>
    <div class="login-page-container">
        <!-- Background images restored -->
        <div class="background-images">
            <img src="{{ url_for('static', filename='png/hiring.png') }}" alt="" class="bg-image image-1">
            <img src="{{ url_for('static', filename='png/r.png') }}" alt="" class="bg-image image-2">
            <img src="{{ url_for('static', filename='png/recruitment-specialist.png') }}" alt="" class="bg-image image-3">
            <img src="{{ url_for('static', filename='png/search-user.png') }}" alt="" class="bg-image image-4">
            <img src="{{ url_for('static', filename='png/hiring.png') }}" alt="" class="bg-image image-5">
            <img src="{{ url_for('static', filename='png/r.png') }}" alt="" class="bg-image image-6">
            <img src="{{ url_for('static', filename='png/recruitment-specialist.png') }}" alt="" class="bg-image image-7">
            <img src="{{ url_for('static', filename='png/search-user.png') }}" alt="" class="bg-image image-8">
            <img src="{{ url_for('static', filename='png/support.png') }}" alt="" class="bg-image image-9">
            <img src="{{ url_for('static', filename='png/customer-service.png') }}" alt="" class="bg-image image-10">
        </div>
        <div class="form-wrapper" x-data="formWizard()">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/mosla.jpg') }}" alt="Mosla Pioneers Logo" class="logo-image">
                <span>Mosla Pioneers</span>
            </div>

            <h2 x-show="step === 1">Create Your Candidate Profile</h2>
            <p class="subtitle" x-show="step === 1" x-transition>Step 1: Create your account.</p>

            <h2 x-show="step === 2" x-cloak>Complete Your Profile</h2>
            <p class="subtitle" x-show="step === 2" x-cloak x-transition>Step 2: Tell us more about you.</p>

            {% with messages = get_flashed_messages(with_categories=true) %}{% if messages %}{% for category, message in messages %}<div class="alert alert-{{ category }}">{{ message }}</div>{% endfor %}{% endif %}{% endwith %}

            <form method="POST" action="{{ url_for('register_bp.register_candidate', next=request.args.get('next', '')) }}" enctype="multipart/form-data">
                
                <!-- ===== STEP 1: Account Info ===== -->
                <div x-show="step === 1" x-transition>
                    <div class="input-group">
                        <span class="icon"><!-- User Icon SVG --></span>
                        <input type="text" name="first_name" id="first_name" placeholder="First Name" x-model="fields.firstName" class="{{ 'is-invalid' if errors.get('first_name') }}">
                        {% if errors.get('first_name') %}<div class="invalid-feedback">{{ errors.get('first_name') }}</div>{% endif %}
                    </div>
                    <div class="input-group">
                        <span class="icon"><!-- User Icon SVG --></span>
                        <input type="text" name="last_name" id="last_name" placeholder="Last Name" x-model="fields.lastName" class="{{ 'is-invalid' if errors.get('last_name') }}">
                        {% if errors.get('last_name') %}<div class="invalid-feedback">{{ errors.get('last_name') }}</div>{% endif %}
                    </div>
                    <div class="input-group">
                        <span class="icon"><!-- Email Icon SVG --></span>
                        <input type="email" name="email" id="email" placeholder="Email Address" x-model="fields.email" class="{{ 'is-invalid' if errors.get('email') }}">
                        {% if errors.get('email') %}<div class="invalid-feedback">{{ errors.get('email') }}</div>{% endif %}
                    </div>
                    <div class="input-group">
                        <span class="icon"><!-- Phone Icon SVG --></span>
                        <input type="tel" name="phone_number" id="phone_number" placeholder="Phone Number (Optional)" x-model="fields.phone">
                    </div>
                    <div class="input-group">
                        <span class="icon"><!-- Lock Icon SVG --></span>
                        <input type="password" name="password" id="password" placeholder="Create Password" x-model="fields.password" class="{{ 'is-invalid' if errors.get('password') }}">
                        {% if errors.get('password') %}<div class="invalid-feedback">{{ errors.get('password') }}</div>{% endif %}
                    </div>
                    <div class="input-group">
                        <span class="icon"><!-- Lock Icon SVG --></span>
                        <input type="password" name="confirm_password" id="confirm_password" placeholder="Confirm Password" x-model="fields.confirmPassword" class="{{ 'is-invalid' if errors.get('confirm_password') }}">
                        {% if errors.get('confirm_password') %}<div class="invalid-feedback">{{ errors.get('confirm_password') }}</div>{% endif %}
                    </div>
                    <button type="button" @click="nextStep()" class="login-button">Next</button>
                </div>

                <!-- ===== STEP 2: Profile Details ===== -->
                <div x-show="step === 2" x-cloak x-transition>
                    <div class="input-group">
                        <span class="icon"><!-- LinkedIn Icon SVG --></span>
                        <input type="url" name="linkedin_profile_url" placeholder="LinkedIn Profile URL (Optional)" value="{{ form_data.get('linkedin_profile_url', '') }}">
                    </div>
                    <div class="file-upload-group">
                        <span class="icon"><!-- Picture Icon SVG --></span>
                        <label for="profile_picture" id="profile_picture_label" class="file-upload-label">Upload Profile Picture (Optional)</label>
                        <input type="file" name="profile_picture" id="profile_picture" accept="image/*">
                    </div>
                    <div class="file-upload-group {{ 'is-invalid' if errors.get('cv_file') }}">
                        <span class="icon"><!-- CV Icon SVG --></span>
                        <label for="cv_file" id="cv_label" class="file-upload-label">Upload your Resume/CV</label>
                        <input type="file" name="cv_file" id="cv_file" accept=".pdf,.doc,.docx">
                    </div>
                    {% if errors.get('cv_file') %}<div class="invalid-feedback" style="margin-top: -1.25rem; margin-bottom: 1.5rem;">{{ errors.get('cv_file') }}</div>{% endif %}

                    <div class="input-group">
                        <select name="educational_status" style="padding-left: 14px;">
                            <option value="" disabled selected>Select Graduation Status...</option>
                            <option value="Graduate">Graduate</option><option value="Student">Student</option><option value="Dropout">Dropout</option><option value="Gap Year">Gap Year</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <select name="english_level" style="padding-left: 14px;">
                            <option value="" disabled selected>Select English Level...</option>
                            <option value="A1">A1</option><option value="A2">A2</option><option value="B1">B1</option><option value="B2">B2</option><option value="C1">C1</option><option value="C2">C2</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <input type="number" name="age" min="16" max="60" placeholder="Your age" style="padding-left: 14px;">
                    </div>

                    <div style="display: flex; gap: 1rem;">
                        <button type="button" @click="step = 1" class="login-button" style="background: #6c757d;">Back</button>
                        <button type="submit" class="login-button">Create Account</button>
                    </div>
                </div>
            </form>
            <div class="signup-link">
                <p>Already have an account? <a href="{{ url_for('login_bp.login') }}">Log In</a></p>
            </div>
        </div>
    </div>

<script>
    function formWizard() {
        return {
            step: {{ 2 if errors else 1 }}, // Start on step 2 if there was a server-side error
            fields: {
                firstName: '{{ form_data.get("first_name", "")|e }}',
                lastName: '{{ form_data.get("last_name", "")|e }}',
                email: '{{ form_data.get("email", "")|e }}',
                phone: '{{ form_data.get("phone_number", "")|e }}',
                password: '',
                confirmPassword: ''
            },
            nextStep() {
                // Simple validation to move to the next step
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!this.fields.firstName.trim()) { alert('First name is required.'); return; }
                if (!this.fields.lastName.trim()) { alert('Last name is required.'); return; }
                if (!emailRegex.test(this.fields.email)) { alert('Please enter a valid email.'); return; }
                if (this.fields.password.length < 6) { alert('Password must be at least 6 characters.'); return; }
                if (this.fields.password !== this.fields.confirmPassword) { alert('Passwords do not match.'); return; }
                this.step = 2;
            },
            init() {
                const setupFileInputLabel = (inputId, labelId, defaultText) => {
                    const fileInput = document.getElementById(inputId);
                    const fileLabel = document.getElementById(labelId);
                    if (fileInput && fileLabel) {
                        fileInput.addEventListener('change', () => {
                            fileLabel.textContent = fileInput.files.length > 0 ? fileInput.files[0].name : defaultText;
                            fileLabel.classList.toggle('has-file', fileInput.files.length > 0);
                        });
                    }
                };
                setupFileInputLabel('profile_picture', 'profile_picture_label', 'Upload Profile Picture (Optional)');
                setupFileInputLabel('cv_file', 'cv_label', 'Upload your Resume/CV');
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Your theme toggle and password visibility scripts remain the same
    });
</script>
</body>
</html>