{% extends "agency_staff_portal/staff_base.html" %}

{% block staff_title %}{{ title }}{% endblock %}
{% block staff_page_title %}{{ title }}{% endblock %}

{% block staff_content %}
<div class="mb-6">
    <a href="{{ url_for('staff_perf_bp.list_all_staff') }}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50">
        <i class="bi bi-arrow-left -ml-1 mr-2"></i> Back to All Staff
    </a>
</div>

{% set onboarding_tasks = tasks|selectattr('ChecklistType', 'equalto', 'Onboarding')|list %}
{% set offboarding_tasks = tasks|selectattr('ChecklistType', 'equalto', 'Offboarding')|list %}

<div class="space-y-10">
    <!-- Onboarding Checklist Section -->
    {% if onboarding_tasks %}
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-800">Onboarding Checklist</h3>
        </div>
        <ul class="divide-y divide-gray-200">
            {% for task in onboarding_tasks %}
            <li class="p-6">
                <form method="POST" action="{{ url_for('staff_perf_bp.update_checklist_task', assigned_task_id=task.AssignedTaskID) }}">
                    <input type="hidden" name="staff_id" value="{{ staff_id }}">
                    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                        <!-- Task Info -->
                        <div>
                            <p class="font-semibold text-gray-900">{{ task.TaskName }}</p>
                            <p class="text-sm text-gray-500 mt-1">{{ task.TaskDescription or 'No description provided.' }}</p>
                            <p class="text-xs text-gray-400 mt-2">Typically assigned to: {{ task.DefaultAssignedTo }}</p>
                            {% if task.Status == 'Completed' and task.CompleterFirstName %}
                                <p class="text-xs text-green-600 mt-1">Completed by {{ task.CompleterFirstName }}</p>
                            {% endif %}
                        </div>
                        <!-- Actions -->
                        <div class="flex-shrink-0 w-full md:w-64">
                            <label for="status_{{ task.AssignedTaskID }}" class="sr-only">Status</label>
                            <select name="status" id="status_{{ task.AssignedTaskID }}" class="block w-full rounded-md border-gray-300 shadow-sm sm:text-sm">
                                <option value="Pending" {% if task.Status == 'Pending' %}selected{% endif %}>Pending</option>
                                <option value="Completed" {% if task.Status == 'Completed' %}selected{% endif %}>Completed</option>
                                <option value="NA" {% if task.Status == 'NA' %}selected{% endif %}>N/A</option>
                            </select>
                            <textarea name="notes" rows="2" class="mt-2 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" placeholder="Optional notes...">{{ task.Notes or '' }}</textarea>
                            <button type="submit" class="mt-2 w-full btn-primary-sm">Update</button>
                        </div>
                    </div>
                </form>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Offboarding Checklist Section -->
    {% if offboarding_tasks %}
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-800">Offboarding Checklist</h3>
        </div>
        <ul class="divide-y divide-gray-200">
            {% for task in offboarding_tasks %}
            <li class="p-6">
                <form method="POST" action="{{ url_for('staff_perf_bp.update_checklist_task', assigned_task_id=task.AssignedTaskID) }}">
                    <input type="hidden" name="staff_id" value="{{ staff_id }}">
                    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                        <!-- Task Info -->
                        <div>
                            <p class="font-semibold text-gray-900">{{ task.TaskName }}</p>
                            <p class="text-sm text-gray-500 mt-1">{{ task.TaskDescription or 'No description provided.' }}</p>
                            <p class="text-xs text-gray-400 mt-2">Typically assigned to: {{ task.DefaultAssignedTo }}</p>
                            {% if task.Status == 'Completed' and task.CompleterFirstName %}
                                <p class="text-xs text-green-600 mt-1">Completed by {{ task.CompleterFirstName }}</p>
                            {% endif %}
                        </div>
                        <!-- Actions -->
                        <div class="flex-shrink-0 w-full md:w-64">
                            <label for="status_{{ task.AssignedTaskID }}" class="sr-only">Status</label>
                            <select name="status" id="status_{{ task.AssignedTaskID }}" class="block w-full rounded-md border-gray-300 shadow-sm sm:text-sm">
                                <option value="Pending" {% if task.Status == 'Pending' %}selected{% endif %}>Pending</option>
                                <option value="Completed" {% if task.Status == 'Completed' %}selected{% endif %}>Completed</option>
                                <option value="NA" {% if task.Status == 'NA' %}selected{% endif %}>N/A</option>
                            </select>
                            <textarea name="notes" rows="2" class="mt-2 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" placeholder="Optional notes...">{{ task.Notes or '' }}</textarea>
                            <button type="submit" class="mt-2 w-full btn-primary-sm">Update</button>
                        </div>
                    </div>
                </form>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if not tasks %}
    <div class="text-center py-16">
        <p class="text-gray-500">No checklist tasks have been generated for this staff member.</p>
        <p class="text-sm text-gray-400 mt-1">Onboarding checklists are created automatically when a staff application is approved.</p>
    </div>
    {% endif %}
</div>
{% endblock %}