{% extends "agency_staff_portal/staff_base.html" %}

{% block staff_title %}{{ title }}{% endblock %}
{% block staff_page_title %}{{ title }}{% endblock %}

{% block staff_content %}
<div class="max-w-3xl mx-auto bg-card p-6 rounded-xl shadow border border-border">
    <form method="POST" action="{{ url_for(request.endpoint, announcement_id=announcement_id if announcement_id else None) }}" class="space-y-6">
        {% if action_verb == 'Update' %}
            <input type="hidden" name="original_title_hidden" value="{{ original_title_hidden or form_data.get('Title', '') }}">
        {% endif %}

        <div>
            <label for="title" class="form-label">Title <span class="text-danger">*</span></label>
            <input type="text" id="title" name="title" value="{{ form_data.get('title', form_data.get('Title', '')) }}" required
                   class="form-input {{ 'border-danger' if errors.get('title') }}">
            {% if errors.get('title') %}<p class="mt-1 text-xs text-danger">{{ errors.get('title') }}</p>{% endif %}
        </div>

        <div>
            <label for="content" class="form-label">Content <span class="text-danger">*</span></label>
            <textarea id="content" name="content" rows="6" required
                      class="form-textarea {{ 'border-danger' if errors.get('content') }}">{{ form_data.get('content', form_data.get('Content', '')) }}</textarea>
            {% if errors.get('content') %}<p class="mt-1 text-xs text-danger">{{ errors.get('content') }}</p>{% endif %}
        </div>

        <div class="grid grid-cols-1 gap-x-6 gap-y-6 sm:grid-cols-2">
            <div>
                <label for="audience" class="form-label">Audience</label>
                <select id="audience" name="audience" class="form-select {{ 'border-danger' if errors.get('audience') }}">
                    {% set current_audience = form_data.get('audience', form_data.get('Audience', 'AllStaff')) %}
                    <option value="AllStaff" {% if current_audience == 'AllStaff' %}selected{% endif %}>All Staff</option>
                    <option value="Recruiters" {% if current_audience == 'Recruiters' %}selected{% endif %}>Recruiters Only</option>
                    <option value="AccountManagers" {% if current_audience == 'AccountManagers' %}selected{% endif %}>Account Managers Only</option>
                    <option value="Sales" {% if current_audience == 'Sales' %}selected{% endif %}>Sales Team Only</option>
                    <option value="AllUsers" {% if current_audience == 'AllUsers' %}selected{% endif %}>All Portal Users</option>
                </select>
                {% if errors.get('audience') %}<p class="mt-1 text-xs text-danger">{{ errors.get('audience') }}</p>{% endif %}
            </div>
            <div>
                <label for="priority" class="form-label">Priority</label>
                <select id="priority" name="priority" class="form-select {{ 'border-danger' if errors.get('priority') }}">
                    {% set current_priority = form_data.get('priority', form_data.get('Priority', 'Normal')) %}
                    <option value="Normal" {% if current_priority == 'Normal' %}selected{% endif %}>Normal</option>
                    <option value="High" {% if current_priority == 'High' %}selected{% endif %}>High</option>
                    <option value="Urgent" {% if current_priority == 'Urgent' %}selected{% endif %}>Urgent</option>
                </select>
                {% if errors.get('priority') %}<p class="mt-1 text-xs text-danger">{{ errors.get('priority') }}</p>{% endif %}
            </div>
        </div>

        <div>
            <label for="display_until" class="form-label">Display Until (Optional)</label>
            <input type="datetime-local" id="display_until" name="display_until" value="{{ form_data.get('display_until', form_data.get('DisplayUntil', '')) }}"
                   class="form-input {{ 'border-danger' if errors.get('display_until') }}">
            <p class="mt-1.5 text-xs text-text-muted">Leave blank if the announcement should not expire.</p>
            {% if errors.get('display_until') %}<p class="mt-1 text-xs text-danger">{{ errors.get('display_until') }}</p>{% endif %}
        </div>

        <div class="relative flex items-start">
            <div class="flex h-5 items-center">
                <input id="is_active" name="is_active" type="checkbox" value="on" class="form-checkbox"
                       {% if form_data.get('is_active', form_data.get('IsActive', True if action_verb == 'Add' else False)) %}checked{% endif %}>
            </div>
            <div class="ml-3 text-sm">
                <label for="is_active" class="font-medium text-text">Is Active</label>
                <p class="text-text-muted">Make this announcement visible to the selected audience.</p>
            </div>
        </div>
        
        <div class="pt-5 mt-5 border-t border-border">
            <div class="flex justify-end gap-3">
                <a href="{{ url_for('announcement_bp.list_announcements') }}" class="btn-secondary">Cancel</a>
                <button type="submit" class="btn-primary">
                    {{ action_verb }} Announcement
                </button>
            </div>
             {% if errors.get('form') %} 
                <p class="mt-4 text-xs text-danger text-right">{{ errors.get('form') }}</p>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}