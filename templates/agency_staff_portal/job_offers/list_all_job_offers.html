<!-- templates/agency_staff_portal/job_offers/list_all_job_offers.html -->
{% extends 'agency_staff_portal/staff_base.html' %}

{% block staff_title %}{{ title }}{% endblock %}
{% block staff_page_title %}<i class="bi bi-card-list text-text-muted"></i> <span>{{ title }}</span>{% endblock %}

{% block staff_content %}
<div class="mb-6 flex justify-end">
    <a href="{{ url_for('.staff_direct_create_job_offer') }}" class="btn-primary"><i class="bi bi-plus-circle-fill mr-1"></i> Create New Job Offer</a>
</div>

<div class="space-y-4" x-data="{ openCompanyId: null }">
    {% for company_id, company_data in offers_by_company.items() %}
    <div class="bg-card shadow rounded-lg border border-border">
        <!-- Company Header -->
        <div @click="openCompanyId = openCompanyId === {{ company_id }} ? null : {{ company_id }}" class="p-4 sm:px-6 sm:py-4 cursor-pointer flex flex-col sm:flex-row justify-between sm:items-center gap-4 hover:bg-background/50">
            <div class="flex items-center gap-4"><h2 class="text-lg font-semibold text-heading">{{ company_data.company_name }}</h2><span class="inline-flex items-center rounded-md bg-primary/10 px-2 py-1 text-xs font-medium text-primary">{{ company_data.offers|length }} Offer(s)</span></div>
            <div class="flex items-center space-x-3 self-end sm:self-center"><a href="{{ url_for('.view_company_schedules', company_id=company_id) }}" @click.stop class="btn-secondary text-xs py-1 px-2"><i class="bi bi-calendar-week-fill mr-1"></i> Schedule</a><i class="bi bi-chevron-down transition-transform" :class="{'rotate-180': openCompanyId === {{ company_id }} }"></i></div>
        </div>

        <!-- Collapsible Offer List -->
        <div x-show="openCompanyId === {{ company_id }}" x-collapse class="border-t border-border">
            <!-- Desktop Table -->
            <div class="hidden sm:block overflow-x-auto">
                <table class="min-w-full divide-y divide-border text-sm">
                    <thead class="bg-background"><tr class="text-left text-xs font-medium text-text-muted uppercase tracking-wider"><th class="px-6 py-3">Job Title</th><th class="px-6 py-3">Date Posted</th><th class="px-6 py-3">Status</th><th class="relative px-6 py-3"><span class="sr-only">Actions</span></th></tr></thead>
                    <tbody class="divide-y divide-border">
                        {% for offer in company_data.offers %}
                        <tr>
                            <td class="px-6 py-4"><div class="font-medium text-heading">{{ offer.Title }}</div><div class="text-text-muted">{{ offer.CategoryName or 'No Category' }}</div></td>
                            <td class="px-6 py-4 text-text-muted">{{ offer.DatePosted.strftime('%Y-%m-%d') if offer.DatePosted else 'N/A' }}</td>
                            <td class="px-6 py-4">
                                {% set status_colors = {'Open': 'bg-green-100 text-green-800','Closed': 'bg-red-100 text-red-800','Filled': 'bg-blue-100 text-blue-800','On Hold': 'bg-yellow-100 text-yellow-800'} %}
                                <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium {{ status_colors.get(offer.Status, 'bg-gray-100 text-gray-800') }}">{{ offer.Status }}</span>
                            </td>
                            <td class="px-6 py-4 text-right font-medium space-x-4">
                                <a href="{{ url_for('.view_live_job_offer_detail', offer_id=offer.OfferID) }}" class="text-text-muted hover:text-primary" title="View"><i class="bi bi-eye-fill"></i></a>
                                <a href="{{ url_for('.edit_live_job_offer', offer_id=offer.OfferID) }}" class="text-text-muted hover:text-primary" title="Edit"><i class="bi bi-pencil-fill"></i></a>
                                <form action="{{ url_for('.delete_live_job_offer', offer_id=offer.OfferID) }}" method="POST" class="inline" onsubmit="return confirm('Delete this job offer?');"><button type="submit" class="text-text-muted hover:text-danger" title="Delete"><i class="bi bi-trash-fill"></i></button></form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Mobile Card View -->
            <div class="sm:hidden divide-y divide-border">
                {% for offer in company_data.offers %}
                <div class="p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-semibold text-heading">{{ offer.Title }}</div>
                            <div class="text-xs text-text-muted">{{ offer.CategoryName or 'No Category' }}</div>
                        </div>
                        {% set status_colors = {'Open': 'bg-green-100 text-green-800','Closed': 'bg-red-100 text-red-800','Filled': 'bg-blue-100 text-blue-800','On Hold': 'bg-yellow-100 text-yellow-800'} %}
                        <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium {{ status_colors.get(offer.Status, 'bg-gray-100 text-gray-800') }}">{{ offer.Status }}</span>
                    </div>
                    <div class="mt-4 pt-4 border-t border-border flex justify-between items-center">
                         <span class="text-xs text-text-muted">Posted: {{ offer.DatePosted.strftime('%d %b, %Y') if offer.DatePosted else 'N/A' }}</span>
                         <div class="flex space-x-4">
                            <a href="{{ url_for('.view_live_job_offer_detail', offer_id=offer.OfferID) }}" class="text-text-muted hover:text-primary" title="View"><i class="bi bi-eye-fill"></i></a>
                            <a href="{{ url_for('.edit_live_job_offer', offer_id=offer.OfferID) }}" class="text-text-muted hover:text-primary" title="Edit"><i class="bi bi-pencil-fill"></i></a>
                            <form action="{{ url_for('.delete_live_job_offer', offer_id=offer.OfferID) }}" method="POST" class="inline" onsubmit="return confirm('Delete this job offer?');"><button type="submit" class="text-text-muted hover:text-danger" title="Delete"><i class="bi bi-trash-fill"></i></button></form>
                         </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}