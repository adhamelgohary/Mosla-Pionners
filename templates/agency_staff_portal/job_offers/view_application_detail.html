<!-- templates/agency_staff_portal/job_offers/view_application_detail.html -->
{% extends "agency_staff_portal/staff_base.html" %}

{% block staff_title %}{{ title }}{% endblock %}

{% block staff_page_title %}
    <a href="{{ url_for('job_offer_mgmt_bp.list_all_applications') }}" class="text-text-muted hover:text-heading"><i class="bi bi-arrow-left-circle-fill"></i></a>
    <span class="fluid-text-lg ml-3">{{ title }}</span>
{% endblock %}

{% block staff_content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 xl:gap-8">

    <!-- Left Column: Candidate & Application Info -->
    <div class="lg:col-span-1 space-y-6">
        <div class="bg-card p-6 rounded-lg shadow border border-border">
            <div class="flex flex-col sm:flex-row items-center gap-4 text-center sm:text-left">
                <img class="h-20 w-20 rounded-full object-cover ring-4 ring-background" src="{{ url_for('static', filename=details.ProfilePictureURL) if details.ProfilePictureURL else url_for('static', filename='images/default-profile.png') }}" alt="Profile Photo">
                <div>
                    <h3 class="text-xl font-bold text-heading">{{ details.FirstName }} {{ details.LastName }}</h3>
                    <p class="text-sm text-text-muted">{{ details.Email }}</p>
                    <p class="text-sm text-text-muted">{{ details.PhoneNumber }}</p>
                </div>
            </div>
            <div class="mt-5 border-t border-border pt-5">
                <dl class="space-y-3"><div class="flex justify-between text-sm"><dt class="text-text-muted">Nationality</dt><dd class="text-heading font-medium">{{ details.Nationality or 'N/A' }}</dd></div><div class="flex justify-between text-sm"><dt class="text-text-muted">Education</dt><dd class="text-heading font-medium">{{ details.EducationalStatus or 'N/A' }}</dd></div><div class="flex justify-between text-sm"><dt class="text-text-muted">Languages</dt><dd class="text-heading font-medium">{{ details.Languages or 'N/A' }} ({{ details.LanguageLevel or 'N/A' }})</dd></div></dl>
            </div>
        </div>

        <div class="bg-card p-6 rounded-lg shadow border border-border">
            <h3 class="text-lg font-semibold text-heading">Application Details</h3>
            <dl class="mt-4 space-y-3">
                <div class="flex justify-between text-sm"><dt class="text-text-muted">Job</dt><dd class="text-heading font-medium text-right">{{ details.JobTitle }}</dd></div>
                <div class="flex justify-between text-sm"><dt class="text-text-muted">Company</dt><dd class="text-heading font-medium">{{ details.CompanyName }}</dd></div>
                <div class="flex justify-between text-sm"><dt class="text-text-muted">Applied On</dt><dd class="text-heading font-medium">{{ details.ApplicationDate.strftime('%d %b, %Y') if details.ApplicationDate }}</dd></div>
                <div class="flex justify-between items-center text-sm"><dt class="text-text-muted">Status</dt>
                    <dd>
                        {% set status_classes = {'Hired': 'bg-success/10 text-success-700','Rejected': 'bg-danger/10 text-danger-700'} %}
                        <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full {{ status_classes.get(details.ApplicationStatus, 'bg-primary/10 text-primary-800') }}">{{ details.ApplicationStatus }}</span>
                    </dd>
                </div>
            </dl>
        </div>
    </div>

    <!-- Right Column: Interview and Notes -->
    <div class="lg:col-span-2 space-y-6">
        <div class="bg-card p-6 rounded-lg shadow border border-border">
            <h3 class="text-lg font-semibold text-heading">Interview Information</h3>
            {% if details.InterviewID %}
            <dl class="mt-4 grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2">
                <div><dt class="text-sm font-medium text-text-muted">Scheduled For</dt><dd class="mt-1 text-lg font-semibold text-primary">{{ details.ScheduledDateTime.strftime('%a, %d %b %Y at %I:%M %p') }}</dd></div>
                <div><dt class="text-sm font-medium text-text-muted">Status</dt>
                    <dd class="mt-1 text-sm">
                        {% set interview_status_classes = {'Completed': 'bg-success/10 text-success-700','Scheduled': 'bg-primary/10 text-primary-800','NoShow': 'bg-danger/10 text-danger-700', 'Cancelled': 'bg-danger/10 text-danger-700'} %}
                        <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full {{ interview_status_classes.get(details.InterviewStatus, 'bg-slate/10 text-slate-700') }}">{{ details.InterviewStatus }}</span>
                    </dd>
                </div>
                <div class="sm:col-span-2"><dt class="text-sm font-medium text-text-muted">Interview Notes</dt><dd class="mt-1 text-sm text-text bg-background p-3 rounded-md prose prose-sm max-w-none dark:prose-invert">{{ details.InterviewNotes or 'No notes recorded.' }}</dd></div>
            </dl>
            {% else %}
            <div class="mt-4 text-center py-8 bg-background rounded-lg"><i class="bi bi-calendar-x text-4xl text-border"></i><p class="mt-2 text-sm text-text-muted">No interview scheduled yet.</p></div>
            {% endif %}
        </div>

        <div class="bg-card p-6 rounded-lg shadow border border-border">
            <h3 class="text-lg font-semibold text-heading">Notes & Feedback</h3>
            <div class="mt-4 space-y-6">
                <div><h4 class="text-sm font-medium text-heading">Notes from Candidate</h4><div class="mt-2 text-sm text-text bg-blue-50 dark:bg-sky-900/40 p-4 rounded-md prose prose-sm max-w-none dark:prose-invert">{{ details.NotesByCandidate or 'No notes provided by the candidate.' }}</div></div>
                <div><h4 class="text-sm font-medium text-heading">Internal Staff Notes</h4><div class="mt-2 text-sm text-text bg-amber-50 dark:bg-amber-900/40 p-4 rounded-md prose prose-sm max-w-none dark:prose-invert whitespace-pre-wrap">{{ details.NotesByStaff or 'No internal notes recorded.' }}</div></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}