<!-- templates/agency_staff_portal/job_offers/view_application_detail.html -->
{% extends "agency_staff_portal/staff_base.html" %}

{% block staff_title %}{{ title }}{% endblock %}

{% block staff_page_title %}
    <a href="{{ url_for('job_offer_mgmt_bp.list_all_applications') }}" class="text-gray-400 hover:text-gray-600">
        <i class="bi bi-arrow-left-circle-fill"></i>
    </a>
    <span class="fluid-text-lg ml-3">{{ title }}</span>
{% endblock %}

{% block staff_content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 xl:gap-8">

    <!-- Left Column: Candidate & Application Info -->
    <div class="lg:col-span-1 space-y-6">
        <!-- Candidate Card -->
        <div class="bg-white p-6 rounded-xl shadow-lg border">
            <div class="flex items-center space-x-4">
                <img class="h-20 w-20 rounded-full object-cover ring-4 ring-white" src="{{ url_for('static', filename=details.ProfilePictureURL) if details.ProfilePictureURL else url_for('static', filename='images/default-profile.png') }}" alt="Profile Photo">
                <div>
                    <h3 class="text-xl font-bold text-gray-900">{{ details.FirstName }} {{ details.LastName }}</h3>
                    <p class="text-sm text-gray-500">{{ details.Email }}</p>
                    <p class="text-sm text-gray-500">{{ details.PhoneNumber }}</p>
                </div>
            </div>
            <div class="mt-5 border-t border-gray-200 pt-5">
                <dl class="space-y-3">
                    <div class="flex justify-between text-sm"><dt class="text-gray-500">Nationality</dt><dd class="text-gray-900 font-medium">{{ details.Nationality or 'N/A' }}</dd></div>
                    <div class="flex justify-between text-sm"><dt class="text-gray-500">Education</dt><dd class="text-gray-900 font-medium">{{ details.EducationalStatus or 'N/A' }}</dd></div>
                    <div class="flex justify-between text-sm"><dt class="text-gray-500">Languages</dt><dd class="text-gray-900 font-medium">{{ details.Languages or 'N/A' }} ({{ details.LanguageLevel or 'N/A' }})</dd></div>
                </dl>
            </div>
        </div>

        <!-- Application Status Card -->
        <div class="bg-white p-6 rounded-xl shadow-lg border">
            <h3 class="text-lg font-semibold text-gray-900">Application Details</h3>
            <dl class="mt-4 space-y-3">
                <div class="flex justify-between text-sm"><dt class="text-gray-500">Applied For</dt><dd class="text-gray-900 font-medium text-right">{{ details.JobTitle }}</dd></div>
                <div class="flex justify-between text-sm"><dt class="text-gray-500">Company</dt><dd class="text-gray-900 font-medium">{{ details.CompanyName }}</dd></div>
                <div class="flex justify-between text-sm"><dt class="text-gray-500">Applied On</dt><dd class="text-gray-900 font-medium">{{ details.ApplicationDate.strftime('%d %b, %Y') if details.ApplicationDate }}</dd></div>
                <div class="flex justify-between items-center text-sm"><dt class="text-gray-500">Status</dt>
                    <dd>
                        <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full
                            {% if details.ApplicationStatus == 'Hired' %} bg-success-100 text-success-700
                            {% elif details.ApplicationStatus in ['Submitted', 'Shortlisted', 'Interview Scheduled'] %} bg-primary-100 text-primary-800
                            {% elif details.ApplicationStatus == 'Rejected' %} bg-danger-100 text-danger-700
                            {% else %} bg-gray-100 text-gray-800 {% endif %}">
                            {{ details.ApplicationStatus }}
                        </span>
                    </dd>
                </div>
            </dl>
        </div>
    </div>

    <!-- Right Column: Interview and Notes -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Interview Details Card -->
        <div class="bg-white p-6 rounded-xl shadow-lg border">
            <h3 class="text-lg font-semibold text-gray-900">Interview Information</h3>
            {% if details.InterviewID %}
            <dl class="mt-4 grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2">
                <div>
                    <dt class="text-sm font-medium text-gray-500">Scheduled Date & Time</dt>
                    <dd class="mt-1 text-lg font-semibold text-primary-700">{{ details.ScheduledDateTime.strftime('%A, %d %B %Y at %I:%M %p') }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Interview Status</dt>
                    <dd class="mt-1 text-sm text-gray-900">
                        <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full
                            {% if details.InterviewStatus == 'Completed' %} bg-success-100 text-success-700
                            {% elif details.InterviewStatus == 'Scheduled' %} bg-primary-100 text-primary-800
                            {% elif details.InterviewStatus in ['NoShow', 'Cancelled'] %} bg-danger-100 text-danger-700
                            {% else %} bg-gray-100 text-gray-800 {% endif %}">
                            {{ details.InterviewStatus }}
                        </span>
                    </dd>
                </div>
                <div class="sm:col-span-2">
                    <dt class="text-sm font-medium text-gray-500">Interview Notes</dt>
                    <dd class="mt-1 text-sm text-gray-700 bg-gray-50 p-3 rounded-md prose max-w-none">{{ details.InterviewNotes or 'No notes recorded for this interview.' }}</dd>
                </div>
            </dl>
            {% else %}
            <div class="mt-4 text-center py-8 bg-gray-50 rounded-lg">
                <i class="bi bi-calendar-x text-4xl text-gray-400"></i>
                <p class="mt-2 text-sm text-gray-600">No interview has been scheduled for this application yet.</p>
            </div>
            {% endif %}
        </div>

        <!-- Notes Card -->
        <div class="bg-white p-6 rounded-xl shadow-lg border">
            <h3 class="text-lg font-semibold text-gray-900">Notes & Feedback</h3>
            <div class="mt-4 space-y-6">
                <div>
                    <h4 class="text-sm font-medium text-gray-600">Notes from Candidate</h4>
                    <p class="mt-2 text-sm text-gray-700 bg-blue-50 p-4 rounded-md prose max-w-none">{{ details.NotesByCandidate or 'No notes were provided by the candidate.' }}</p>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-600">Internal Staff Notes (e.g., Shortlisting Feedback)</h4>
                    <div class="mt-2 text-sm text-gray-700 bg-yellow-50 p-4 rounded-md prose max-w-none whitespace-pre-wrap">{{ details.NotesByStaff or 'No internal notes have been recorded for this application.' }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}