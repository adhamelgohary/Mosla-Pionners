{% extends "agency_staff_portal/staff_base.html" %}

{% block staff_title %}{{ title }}{% endblock %}
{% block staff_page_title %}{{ title }}{% endblock %}

{% block staff_content %}
<div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-sm border border-gray-200">
    <form method="POST" action="{% if is_editing_live %}{{ url_for('job_offer_mgmt_bp.edit_live_job_offer', offer_id=offer_id) }}{% else %}{{ url_for('job_offer_mgmt_bp.staff_direct_create_job_offer') }}{% endif %}">
        {% if is_editing_live %}<input type="hidden" name="original_title_hidden" value="{{ original_title_hidden or form_data.get('position-title', '') }}">{% endif %}

        <div class="space-y-8">
            <!-- Section 1: Core Info -->
            <div>
                <h3 class="text-lg font-medium text-gray-900">Core Information</h3>
                <p class="mt-1 text-sm text-gray-500">Essential details about the role and company.</p>
                <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                    <div class="sm:col-span-3">
                        <label for="company_id" class="block text-sm font-medium text-gray-700">Company <span class="text-red-500">*</span></label>
                        <select id="company_id" name="company_id" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm {{ 'border-red-500' if errors.get('company_id') }}">
                            <option value="">Select Company...</option>
                            {% for company in companies %}<option value="{{ company.CompanyID }}" {% if form_data.get('company_id')|string == company.CompanyID|string %}selected{% endif %}>{{ company.CompanyName }}</option>{% endfor %}
                        </select>
                        {% if errors.get('company_id') %}<p class="mt-2 text-sm text-red-600">{{ errors.get('company_id') }}</p>{% endif %}
                    </div>
                    <div class="sm:col-span-3">
                        <label for="category_id" class="block text-sm font-medium text-gray-700">Job Category <span class="text-red-500">*</span></label>
                        <select id="category_id" name="category_id" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm {{ 'border-red-500' if errors.get('category_id') }}">
                            <option value="">Select Category...</option>
                             {% for category in categories %}<option value="{{ category.CategoryID }}" {% if form_data.get('category_id')|string == category.CategoryID|string %}selected{% endif %}>{{ category.CategoryName }}</option>{% endfor %}
                        </select>
                        {% if errors.get('category_id') %}<p class="mt-2 text-sm text-red-600">{{ errors.get('category_id') }}</p>{% endif %}
                    </div>
                    <div class="sm:col-span-4">
                        <label for="position-title" class="block text-sm font-medium text-gray-700">Position / Job Title <span class="text-red-500">*</span></label>
                        <input type="text" id="position-title" name="position-title" value="{{ form_data.get('position-title', '') }}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm" placeholder="e.g., Senior Customer Service Agent">
                        {% if errors.get('position-title') %}<p class="mt-2 text-sm text-red-600">{{ errors.get('position-title') }}</p>{% endif %}
                    </div>
                     <div class="sm:col-span-2">
                        <label for="closing_date" class="block text-sm font-medium text-gray-700">Closing Date</label>
                        <input type="date" id="closing_date" name="closing_date" value="{{ form_data.get('closing_date', '') }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                    </div>
                    <div class="sm:col-span-6">
                        <label for="location" class="block text-sm font-medium text-gray-700">Work Location Address</label>
                        <input type="text" id="location" name="location" value="{{ form_data.get('location', '') }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm" placeholder="e.g., Maadi, Cairo">
                    </div>
                </div>
            </div>

            <!-- Section 2: Requirements -->
            <div class="border-t border-gray-200 pt-8">
                 <h3 class="text-lg font-medium text-gray-900">Candidate Requirements</h3>
                 <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                    <div class="sm:col-span-3">
                        <label for="required_languages" class="block text-sm font-medium text-gray-700">Languages</label>
                        <fieldset class="mt-2">
                            <div class="space-y-2">
                                {% set checked_languages = form_data.get('required_languages', []) %}
                                {% for lang in form_options.RequiredLanguages %}
                                <div class="flex items-center">
                                    <input id="lang-{{ lang|lower }}" name="required_languages" type="checkbox" value="{{ lang }}" {% if lang in checked_languages %}checked{% endif %} class="h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                    <label for="lang-{{ lang|lower }}" class="ml-3 block text-sm text-gray-900">{{ lang }}</label>
                                </div>
                                {% endfor %}
                            </div>
                        </fieldset>
                    </div>
                    <div class="sm:col-span-3">
                        <label for="required_level" class="block text-sm font-medium text-gray-700">Language Level</label>
                        <select id="required_level" name="required_level" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                            <option value="">N/A</option>
                            {% for level in form_options.RequiredLevel %}
                            <option value="{{ level }}" {% if form_data.get('required_level') == level %}selected{% endif %}>{{ level|upper }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="grad-status" class="block text-sm font-medium text-gray-700">Graduation Status</label>
                        <select id="grad-status" name="grad-status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                            {% for status in form_options.GraduationStatusRequirement %}
                            <option value="{{ status }}" {% if form_data.get('grad-status') == status %}selected{% endif %}>{{ status|replace('_', ' ')|title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="max_age" class="block text-sm font-medium text-gray-700">Max Age</label>
                        <input type="number" id="max_age" name="max_age" value="{{ form_data.get('max_age', '') }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                        {% if errors.get('max_age') %}<p class="mt-2 text-sm text-red-600">{{ errors.get('max_age') }}</p>{% endif %}
                    </div>
                    <div class="sm:col-span-2">
                        <label for="nationality" class="block text-sm font-medium text-gray-700">Nationality</label>
                        <select id="nationality" name="nationality" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                           {% for nat in form_options.Nationality %}
                           <option value="{{ nat }}" {% if form_data.get('nationality') == nat %}selected{% endif %}>{{ nat }}</option>
                           {% endfor %}
                        </select>
                    </div>
                 </div>
            </div>
            
             <!-- Section 3: Offer Details -->
            <div class="border-t border-gray-200 pt-8">
                 <h3 class="text-lg font-medium text-gray-900">Hiring & Offer Details</h3>
                 <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                    <div class="sm:col-span-2">
                        <label for="candidate-count" class="block text-sm font-medium text-gray-700">Candidates Needed <span class="text-red-500">*</span></label>
                        <input type="number" id="candidate-count" name="candidate-count" value="{{ form_data.get('candidate-count', '1') }}" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                        {% if errors.get('candidates_needed') %}<p class="mt-2 text-sm text-red-600">{{ errors.get('candidates_needed') }}</p>{% endif %}
                    </div>
                    <div class="sm:col-span-2">
                        <label for="hiring_cadence" class="block text-sm font-medium text-gray-700">Hiring Cadence</label>
                        <select id="hiring_cadence" name="hiring_cadence" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                            {% for cadence in form_options.HiringCadence %}
                            <option value="{{ cadence }}" {% if form_data.get('hiring_cadence') == cadence %}selected{% endif %}>{{ cadence|replace('_', ' ')|title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="sm:col-span-2">
                        <label for="hiring_plan" class="block text-sm font-medium text-gray-700">Hiring Plan</label>
                        <select id="hiring_plan" name="hiring_plan" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                           {% for plan in form_options.HiringPlan %}
                           <option value="{{ plan }}" {% if form_data.get('hiring_plan') == plan %}selected{% endif %}>{{ plan|replace('-', ' ')|title }}</option>
                           {% endfor %}
                        </select>
                    </div>
                    <div class="sm:col-span-3">
                        <label for="salary" class="block text-sm font-medium text-gray-700">Salary (Net)</label>
                        <input type="number" step="0.01" id="salary" name="salary" value="{{ form_data.get('salary', '') }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm {{ 'border-red-500' if errors.get('salary') }}" placeholder="e.g., 8500.00">
                         {% if errors.get('salary') %}<p class="mt-2 text-sm text-red-600">{{ errors.get('salary') }}</p>{% endif %}
                    </div>
                    <div class="sm:col-span-3">
                        <label for="payment_term" class="block text-sm font-medium text-gray-700">Payment Term</label>
                        <input type="text" id="payment_term" name="payment_term" value="{{ form_data.get('payment_term', '') }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm" placeholder="e.g., Monthly, Net 30">
                    </div>
                    <div class="sm:col-span-6">
                        <label for="has_contract" class="block text-sm font-medium text-gray-700">Contract Offered?</label>
                        <div class="mt-2 flex items-center gap-x-4">
                            <label class="inline-flex items-center"><input type="radio" name="has_contract" value="yes" {% if form_data.get('has_contract') == 'yes' %}checked{% endif %} class="h-4 w-4 text-primary-600 border-gray-300 focus:ring-primary-500"> <span class="ml-2">Yes</span></label>
                            <label class="inline-flex items-center"><input type="radio" name="has_contract" value="no" {% if form_data.get('has_contract') == 'no' %}checked{% endif %} class="h-4 w-4 text-primary-600 border-gray-300 focus:ring-primary-500"> <span class="ml-2">No</span></label>
                        </div>
                    </div>
                 </div>
            </div>
            
            <!-- Section 4: Work Environment -->
            <div class="border-t border-gray-200 pt-8">
                 <h3 class="text-lg font-medium text-gray-900">Work Environment</h3>
                 <div class="mt-6 space-y-6">
                    <div>
                        <label class="text-sm font-medium text-gray-700">Work Location Type</label>
                        <div class="mt-2 flex flex-wrap gap-x-4 gap-y-2">
                            {% for loc_type in form_options.WorkLocationType %}
                            <label class="inline-flex items-center">
                                <input type="radio" name="work_location" value="{{ loc_type }}" {% if form_data.get('work_location') == loc_type %}checked{% endif %} class="h-4 w-4 text-primary-600 border-gray-300 focus:ring-primary-500">
                                <span class="ml-2">{{ loc_type|replace('wfh', 'Work From Home')|replace('site', 'On-site') }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-700">Shift Type</label>
                        <div class="mt-2 flex flex-wrap gap-x-4 gap-y-2">
                            {% for s_type in form_options.ShiftType %}
                            <label class="inline-flex items-center">
                                <input type="radio" name="shift_type" value="{{ s_type }}" {% if form_data.get('shift_type') == s_type %}checked{% endif %} class="h-4 w-4 text-primary-600 border-gray-300 focus:ring-primary-500">
                                <span class="ml-2">{{ s_type|title }}</span>
                            </label>
                             {% endfor %}
                        </div>
                    </div>
                    <fieldset>
                        <legend class="text-sm font-medium text-gray-700">Available Shifts</legend>
                        <div class="mt-4 space-y-4 sm:flex sm:items-center sm:space-y-0 sm:space-x-10">
                            {% set checked_shifts = form_data.get('available_shifts', []) %}
                            {% for shift in form_options.AvailableShifts %}
                            <div class="flex items-center">
                                <input id="shift-{{ shift }}" name="available_shifts" type="checkbox" value="{{ shift }}" {% if shift in checked_shifts %}checked{% endif %} class="h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                <label for="shift-{{ shift }}" class="ml-3 block text-sm text-gray-900">{{ shift|title }}</label>
                            </div>
                            {% endfor %}
                        </div>
                    </fieldset>
                 </div>
            </div>

            <!-- Section 5: Benefits & Perks -->
            <div class="border-t border-gray-200 pt-8">
                 <h3 class="text-lg font-medium text-gray-900">Benefits & Perks</h3>
                 <div class="mt-6 space-y-6">
                    <fieldset>
                        <legend class="text-sm font-medium text-gray-700">Benefits Package</legend>
                        <div class="mt-4 space-y-4 sm:flex sm:items-center sm:space-y-0 sm:space-x-10">
                            {% set checked_benefits = form_data.get('benefits_checkboxes', []) %}
                            {% for benefit in form_options.benefits_checkboxes %}
                            <div class="flex items-center">
                                <input id="benefit-{{ loop.index }}" name="benefits_checkboxes" type="checkbox" value="{{ benefit }}" {% if benefit in checked_benefits %}checked{% endif %} class="h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                <label for="benefit-{{ loop.index }}" class="ml-3 block text-sm text-gray-900">{{ benefit|replace('_', ' ')|title }}</label>
                            </div>
                            {% endfor %}
                        </div>
                    </fieldset>
                    <div>
                        <label class="text-sm font-medium text-gray-700">Transportation</label>
                        <div class="mt-2 flex items-center gap-x-4">
                            <label class="inline-flex items-center"><input type="radio" name="transportation" value="yes" {% if form_data.get('transportation') == 'yes' %}checked{% endif %} class="h-4 w-4 text-primary-600 border-gray-300 focus:ring-primary-500"> <span class="ml-2">Provided</span></label>
                            <label class="inline-flex items-center"><input type="radio" name="transportation" value="no" {% if form_data.get('transportation') == 'no' %}checked{% endif %} class="h-4 w-4 text-primary-600 border-gray-300 focus:ring-primary-500"> <span class="ml-2">Not Provided</span></label>
                        </div>
                        <div class="mt-4 pl-8">
                            <label for="transport_type" class="text-sm font-medium text-gray-700">Transportation Type</label>
                            <select id="transport_type" name="transport_type" class="mt-1 block w-full sm:w-1/2 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                                <option value="">Select if provided...</option>
                                {% for key, value in form_options.transportation_options_map.items() %}
                                <option value="{{ key }}" {% if form_data.get('transport_type') == key %}selected{% endif %}>{{ value|replace('Transportation ', '') }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                 </div>
            </div>

            {% if is_editing_live %}
            <div class="border-t border-gray-200 pt-8">
                <h3 class="text-lg font-medium text-gray-900">Offer Status</h3>
                <div class="mt-4">
                    <select name="status" class="mt-1 block w-full sm:w-1/2 rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
                        {% for status in form_options.Status %}
                        <option value="{{ status }}" {% if form_data.get('status') == status %}selected{% endif %}>{{ status }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            {% endif %}

        </div>

        <div class="pt-8 mt-8 border-t border-gray-200 flex justify-end gap-x-3">
            <a href="{{ url_for('job_offer_mgmt_bp.list_all_job_offers') }}" class="rounded-md bg-white px-3.5 py-2.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 transition-colors">Cancel</a>
            <button type="submit" class="inline-flex justify-center rounded-md bg-primary-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600 transition-colors">{{ action_verb }} Offer</button>
        </div>
    </form>
</div>
{% endblock %}