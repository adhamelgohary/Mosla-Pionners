{% extends 'agency_staff_portal/staff_base.html' %}

{% block staff_title %}{{ title }}{% endblock %}

{% block staff_page_title %}
    <i class="bi bi-speedometer2"></i> <span class="fluid-text-lg font-semibold text-heading">{{ title }}</span>
{% endblock %}

{% block staff_content %}
<div class="space-y-12 animate-fade-in-up">
    <!-- KPI Section -->
    <div>
        <h3 class="fluid-text-xl font-semibold leading-6 text-heading">Key Performance Indicators</h3>
        <dl class="mt-5 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
            
            {% macro kpi_card(icon, title, value, footer_text, footer_link, color='primary') %}
            <div class="relative overflow-hidden rounded-xl bg-card p-5 shadow-lg border border-border transition-all duration-300 hocus:-translate-y-1 hocus:shadow-2xl">
                <dt>
                    <div class="absolute rounded-lg p-3 shadow-md 
                        {% if color == 'primary' %} bg-primary 
                        {% elif color == 'warning' %} bg-warning-500
                        {% endif %}">
                        <i class="bi {{ icon }} text-white h-6 w-6"></i>
                    </div>
                    <p class="ml-16 truncate fluid-text-sm font-medium text-text-muted">{{ title }}</p>
                </dt>
                <dd class="ml-16 flex items-baseline pb-6 sm:pb-7">
                    <p class="fluid-text-2xl font-semibold text-heading">{{ value|safe }}</p>
                    <div class="absolute inset-x-0 bottom-0 bg-background/50 px-5 py-4 border-t border-border">
                        <div class="text-sm">
                            <a href="{{ footer_link }}" class="font-semibold text-primary hocus:text-primary-darker transition-colors">
                                {{ footer_text }} <i class="bi bi-arrow-right-short"></i>
                            </a>
                        </div>
                    </div>
                </dd>
            </div>
            {% endmacro %}

            {{ kpi_card(
                icon='bi-briefcase-fill',
                title='Total Open Offers',
                value=kpis.total_open_offers,
                footer_text='View all offers',
                footer_link=url_for('.list_all_job_offers')
            ) }}

            {{ kpi_card(
                icon='bi-people-fill',
                title='Open Positions',
                value=kpis.total_candidates_needed ~ ' <span class=\"fluid-text-lg ml-2 font-normal text-text-muted\">candidates</span>',
                footer_text='View details',
                footer_link=url_for('.list_all_job_offers')
            ) }}

            {{ kpi_card(
                icon='bi-inbox-fill',
                title='Pending Client Submissions',
                value=kpis.pending_submissions,
                footer_text='Review now',
                footer_link=url_for('.list_review_client_submissions'),
                color='warning'
            ) }}
        </dl>
    </div>

    <!-- Quick Stats Section -->
    <div class="bg-card p-6 rounded-xl shadow-lg border border-border">
         <h3 class="fluid-text-lg font-semibold leading-6 text-heading mb-4">Quick Stats</h3>
         <ul class="divide-y divide-border">
             <li class="py-4 flex justify-between items-center fluid-text-sm">
                 <span class="font-medium text-text-muted">New Offers This Month</span>
                 <span class="font-semibold text-heading text-lg bg-primary/10 text-primary px-3 py-1 rounded-full">{{ kpis.new_offers_this_month }}</span>
             </li>
             <li class="py-4 flex justify-between items-center fluid-text-sm">
                 <span class="font-medium text-text-muted">Average Time to Fill</span>
                 <span class="font-semibold text-heading">{{ kpis.avg_time_to_fill }} days</span>
             </li>
             <li class="py-4 flex justify-between items-center fluid-text-sm">
                 <span class="font-medium text-text-muted">Client Submission Approval Rate (90d)</span>
                 <span class="font-semibold text-heading">{{ kpis.approval_rate }}</span>
             </li>
             <li class="py-4 flex justify-between items-center fluid-text-sm">
                <div class="flex flex-col">
                    <span class="font-medium text-text-muted">Oldest Open Offer</span>
                    {% if kpis.oldest_offer_title != 'No open offers' %}
                    <span class="text-xs text-text-muted mt-1">{{ kpis.oldest_offer_title }} at {{ kpis.oldest_offer_company }}</span>
                    {% endif %}
                </div>
                <span class="font-semibold text-heading">{{ kpis.age_of_oldest_offer }} days old</span>
             </li>
         </ul>
    </div>
</div>
{% endblock %}