{% extends "agency_staff_portal/staff_base.html" %}

{% block staff_title %}{{ title }}{% endblock %}
{% block staff_page_title %}{{ title }}{% endblock %}

{% block staff_content %}
<div class="flex flex-col sm:flex-row justify-between items-center mb-6 pb-6 border-b border-gray-200 gap-4">
    <a href="{{ url_for('job_offer_mgmt_bp.list_all_job_offers') }}" class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
        <i class="bi bi-list-ul -ml-1 mr-2"></i> View & Manage All Offers
    </a>
        <!-- *** NEW BUTTON *** -->
    <a href="{{ url_for('job_offer_mgmt_bp.list_all_applications') }}" class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700">
        <i class="bi bi-people -ml-1 mr-2"></i> View All Applications
    </a>
    
    <a href="{{ url_for('job_offer_mgmt_bp.staff_direct_create_job_offer') }}" class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-success-600 hover:bg-success-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-success-500">
        <i class="bi bi-plus-circle -ml-1 mr-2"></i> Create New Offer
    </a>
</div>

{% if error %}
    <div class="bg-red-50 border-l-4 border-red-400 p-4 mb-6">
        <p class="text-sm text-red-700">There was an error loading the dashboard data. Please try again or contact support.</p>
    </div>
{% else %}
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 mb-6 pb-4 border-b border-gray-200">Key Performance Indicators</h3>
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">

            {% macro kpi_card(title, value, footer_text, footer_link=None, color='primary') %}
            <div class="bg-white p-5 rounded-lg shadow border-l-4 border-{{ color }}-500 flex flex-col transition-all duration-200 hover:shadow-md hover:-translate-y-1">
                <div class="text-sm font-medium text-gray-500 truncate">{{ title }}</div>
                <div class="mt-1 text-4xl font-semibold text-{{ color }}-600">{{ value }}</div>
                <div class="mt-auto pt-3 border-t border-gray-100">
                    {% if footer_link %}
                    <a href="{{ footer_link }}" class="text-sm font-medium text-primary-600 hover:text-primary-800">{{ footer_text }} â†’</a>
                    {% else %}
                    <p class="text-sm text-gray-400">{{ footer_text }}</p>
                    {% endif %}
                </div>
            </div>
            {% endmacro %}

            {{ kpi_card('Open Offers', kpis.get('total_open_offers', '0'), 'View All', url_for('job_offer_mgmt_bp.list_all_job_offers'), 'yellow') }}
            {{ kpi_card('Candidates Needed', kpis.get('total_candidates_needed', '0'), 'For Open Jobs', None, 'green') }}
            {{ kpi_card('New Offers This Month', kpis.get('new_offers_this_month', '0'), 'Pipeline Growth', None, 'primary') }}
            {{ kpi_card('Pending Submissions', kpis.get('pending_submissions', '0'), 'Review Now', url_for('job_offer_mgmt_bp.list_review_client_submissions'), 'amber') }}
            
            <div class="bg-white p-5 rounded-lg shadow flex flex-col transition-all duration-200 hover:shadow-md hover:-translate-y-1">
                <div class="text-sm font-medium text-gray-500 truncate">Avg. Time to Fill</div>
                <div class="mt-1 text-4xl font-semibold text-gray-700">{{ kpis.get('avg_time_to_fill', 'N/A') }}</div>
                <div class="mt-auto pt-3 border-t border-gray-100">
                     <p class="text-sm text-gray-400">Days</p>
                </div>
            </div>
            
            {{ kpi_card('Client Approval Rate', kpis.get('approval_rate', 'N/A'), 'Last 90 Days', None, 'info') }}

            <div class="bg-white p-5 rounded-lg shadow border-l-4 border-danger-500 flex flex-col transition-all duration-200 hover:shadow-md hover:-translate-y-1">
                <div class="text-sm font-medium text-gray-500 truncate">Oldest Open Offer</div>
                <div class="mt-1 text-4xl font-semibold text-danger-600">{{ kpis.get('age_of_oldest_offer', 'N/A') }} <span class="text-lg font-medium text-gray-500">Days</span></div>
                <div class="mt-auto pt-3 border-t border-gray-100 text-left">
                    <p class="text-sm font-semibold text-gray-800 truncate" title="{{ kpis.get('oldest_offer_title', '') }}">{{ kpis.get('oldest_offer_title', 'N/A') }}</p>
                    <p class="text-xs text-gray-500 truncate">@ {{ kpis.get('oldest_offer_company', 'N/A') }}</p>
                </div>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}