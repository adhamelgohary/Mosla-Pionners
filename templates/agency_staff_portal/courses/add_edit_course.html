{% extends "agency_staff_portal/staff_base.html" %}

{% block staff_title %}{{ title }}{% endblock %}
{% block staff_page_title %}
    <i class="bi bi-journal-plus text-primary-600"></i> {{ title }}
{% endblock %}

{% block staff_content %}
<div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-sm border border-gray-200">
    <form method="POST" action="{{ url_for(request.endpoint, course_id=course_id if course_id else None) }}" class="space-y-8 divide-y divide-gray-200">
        
        {% if action_verb == 'Update' %}
            <input type="hidden" name="original_course_name_for_title_hidden" value="{{ original_course_name_for_title_hidden or form_data.get('CourseName', '') }}">
        {% endif %}

        {# --- Reusable Form Row Macro --- #}
        {% macro form_row(label, name, type='text', placeholder='', value='', required=False, error=None, extra_attrs='') %}
        <div class="sm:col-span-3">
            <label for="{{ name }}" class="block text-sm font-medium text-gray-700">{{ label }} {% if required %}<span class="text-red-500">*</span>{% endif %}</label>
            <div class="mt-1">
                <input type="{{ type }}" name="{{ name }}" id="{{ name }}" value="{{ value }}" placeholder="{{ placeholder }}" {{ 'required' if required }}
                       class="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm {{ 'border-red-500' if error }}" {{ extra_attrs }}>
            </div>
            {% if error %}<p class="mt-2 text-sm text-red-600">{{ error }}</p>{% endif %}
        </div>
        {% endmacro %}

        {% macro textarea_row(label, name, value='', rows=3, error=None) %}
        <div class="sm:col-span-6">
            <label for="{{ name }}" class="block text-sm font-medium text-gray-700">{{ label }}</label>
            <div class="mt-1">
                <textarea id="{{ name }}" name="{{ name }}" rows="{{ rows }}" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm {{ 'border-red-500' if error }}">{{ value }}</textarea>
            </div>
            {% if error %}<p class="mt-2 text-sm text-red-600">{{ error }}</p>{% endif %}
        </div>
        {% endmacro %}
        {# --- End Macros --- #}

        <div class="space-y-8">
            <div>
                <h3 class="text-lg font-medium leading-6 text-gray-900">Course Information</h3>
                <p class="mt-1 text-sm text-gray-500">Basic details about the course.</p>
                <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                    <div class="sm:col-span-6">{{ form_row('Course Name', 'course_name', value=form_data.get('course_name', form_data.get('CourseName', '')), required=True, error=errors.get('course_name')) }}</div>
                    {{ textarea_row('Description', 'description', value=form_data.get('description', form_data.get('Description', '')), error=errors.get('description')) }}
                </div>
            </div>

            <div class="pt-8">
                <h3 class="text-lg font-medium leading-6 text-gray-900">Pricing & Logistics</h3>
                <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                    {{ form_row('Price', 'price', type='number', value=form_data.get('price', form_data.get('Price', '')), error=errors.get('price'), extra_attrs='step="0.01" min="0"') }}
                    {{ form_row('Currency', 'currency', value=form_data.get('currency', form_data.get('Currency', 'EGP')), placeholder='EGP', error=errors.get('currency')) }}
                    {{ form_row('Duration', 'duration', value=form_data.get('duration', form_data.get('Duration', '')), placeholder='e.g., 4 weeks, 20 hours', error=errors.get('duration')) }}
                    {{ form_row('Instructor Name', 'instructor_name', value=form_data.get('instructor_name', form_data.get('InstructorName', '')), error=errors.get('instructor_name')) }}
                    {{ form_row('Start Date', 'start_date', type='date', value=form_data.get('start_date', form_data.get('StartDate', '')), error=errors.get('start_date')) }}
                    {{ form_row('End Date', 'end_date', type='date', value=form_data.get('end_date', form_data.get('EndDate', '')), error=errors.get('end_date')) }}
                </div>
            </div>

            <div class="pt-8">
                <h3 class="text-lg font-medium leading-6 text-gray-900">Details & Content</h3>
                <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                    <div class="sm:col-span-6">{{ form_row('Category', 'category', value=form_data.get('category', form_data.get('Category', '')), error=errors.get('category')) }}</div>
                    {{ textarea_row('Prerequisites', 'prerequisites', value=form_data.get('prerequisites', form_data.get('Prerequisites', '')), error=errors.get('prerequisites')) }}
                    <div class="sm:col-span-6">{{ form_row('Syllabus Link (URL)', 'syllabus_link', type='url', value=form_data.get('syllabus_link', form_data.get('SyllabusLink', '')), placeholder='https://example.com/syllabus.pdf', error=errors.get('syllabus_link')) }}</div>
                </div>
            </div>

            <div class="pt-8">
                <div class="relative flex items-start">
                    <div class="flex h-5 items-center">
                        <input id="is_active" name="is_active" type="checkbox" value="on" class="h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500"
                               {% if form_data.get('is_active', form_data.get('IsActive', True if action_verb == 'Add' else False)) %}checked{% endif %}>
                    </div>
                    <div class="ml-3 text-sm">
                        <label for="is_active" class="font-medium text-gray-700">Is Active</label>
                        <p class="text-gray-500">Make this course visible and available for enrollment.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="pt-5 mt-5">
            <div class="flex justify-end gap-3">
                <a href="{{ url_for('course_mgmt_bp.list_courses') }}" class="rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50">Cancel</a>
                <button type="submit" class="inline-flex justify-center rounded-md border border-transparent bg-primary-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-primary-700">
                    <i class="bi bi-check-lg -ml-1 mr-2"></i> {{ action_verb }} Course
                </button>
            </div>
            {% if errors.get('form') %}<div class="mt-4 text-sm text-red-600 text-right">{{ errors.get('form') }}</div>{% endif %}
        </div>
    </form>
</div>
{% endblock %}