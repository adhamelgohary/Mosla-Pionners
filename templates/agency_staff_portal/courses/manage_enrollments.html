{% extends "agency_staff_portal/staff_base.html" %}

{% block staff_title %}{{ title }}{% endblock %}

{% block staff_page_title %}
    <i class="bi bi-person-plus-fill text-gray-500"></i>
    <span>{{ title }}</span>
{% endblock %}

{% block staff_content %}
<div class="px-4 py-6 sm:px-0">
    <!-- Header -->
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Pending Course Applications</h2>
        <p class="mt-1 text-sm text-gray-500">Review new applications and update their enrollment status.</p>
    </div>

    <!-- Report Table -->
    <div class="overflow-x-auto bg-white rounded-lg shadow border">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidate Name</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Applied For</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Application Date</th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% if applications %}
                    {% for app in applications %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ app.CandidateFirstName }} {{ app.CandidateLastName }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ app.CandidateEmail }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ app.CourseName }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ app.ApplicationDate.strftime('%Y-%m-%d') if app.ApplicationDate }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                            <div x-data="{ open: false }" class="relative inline-block text-left">
                                <div>
                                    <button @click="open = !open" type="button" class="inline-flex w-full justify-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50" id="menu-button-{{ loop.index }}" aria-expanded="true" aria-haspopup="true">
                                      Actions
                                      <svg class="-mr-1 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" /></svg>
                                    </button>
                                </div>
                                <div x-show="open" @click.away="open = false" x-transition class="absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button-{{ loop.index }}" tabindex="-1" style="display: none;">
                                    <div class="py-1" role="none">
                                        <!-- Confirm Enrollment Action -->
                                        <form action="{{ url_for('course_mgmt_bp.update_enrollment_status', enrollment_id=app.EnrollmentID) }}" method="POST" role="menuitem" tabindex="-1">
                                            <input type="hidden" name="status" value="Enrolled">
                                            <button type="submit" class="text-green-700 font-medium w-full text-left block px-4 py-2 text-sm hover:bg-gray-100">
                                                <i class="bi bi-check-circle-fill mr-2"></i>Confirm Enrollment
                                            </button>
                                        </form>
                                        <!-- Pending Payment Action -->
                                        <form action="{{ url_for('course_mgmt_bp.update_enrollment_status', enrollment_id=app.EnrollmentID) }}" method="POST" role="menuitem" tabindex="-1">
                                            <input type="hidden" name="status" value="PendingPayment">
                                            <button type="submit" class="text-amber-700 w-full text-left block px-4 py-2 text-sm hover:bg-gray-100">
                                                <i class="bi bi-hourglass-split mr-2"></i>Mark as Pending Payment
                                            </button>
                                        </form>
                                        <!-- Cancel Application Action -->
                                        <form action="{{ url_for('course_mgmt_bp.update_enrollment_status', enrollment_id=app.EnrollmentID) }}" method="POST" role="menuitem" tabindex="-1">
                                            <input type="hidden" name="status" value="Cancelled">
                                            <button type="submit" class="text-red-700 w-full text-left block px-4 py-2 text-sm hover:bg-gray-100" onclick="return confirm('Are you sure you want to cancel this application?');">
                                                <i class="bi bi-x-circle-fill mr-2"></i>Cancel Application
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                <tr>
                    <td colspan="5" class="px-6 py-12 text-center text-sm text-gray-500">
                        <i class="bi bi-moon-stars-fill text-4xl text-gray-300 mb-2"></i><br>
                        All clear! There are no pending course applications to review.
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}