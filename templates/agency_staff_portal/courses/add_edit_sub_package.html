{% extends "agency_staff_portal/base.html" %}

{% block content %}
<div class="container-fluid">
    <h1 class="h3 mb-4 text-gray-800">{{ title }}</h1>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Sub-Package Details</h6>
        </div>
        <div class="card-body">
            
            <form method="POST" action="">
                
                <!-- Common Fields -->
                <div class="form-group">
                    <label for="Name">Sub-Package Name*</label>
                    <input type="text" class="form-control" id="Name" name="Name" value="{{ form_data.Name or '' }}" required>
                </div>

                <div class="form-group">
                    <label for="Description">Description</label>
                    <textarea class="form-control" id="Description" name="Description" rows="3">{{ form_data.Description or '' }}</textarea>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="Price">Price</label>
                        <div class="input-group">
                             <div class="input-group-prepend">
                                <span class="input-group-text">EGP</span>
                            </div>
                            <input type="number" step="0.01" class="form-control" id="Price" name="Price" value="{{ form_data.Price or '0.00' }}">
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="DisplayOrder">Display Order</label>
                        <input type="number" class="form-control" id="DisplayOrder" name="DisplayOrder" value="{{ form_data.DisplayOrder or '0' }}">
                        <small class="form-text text-muted">Lower numbers appear first.</small>
                    </div>
                </div>

                <hr>
                <h5 class="mb-3">Session Details</h5>

                {# --- DYNAMIC SESSION FIELDS START --- #}
                {% if main_package_languages|length == 1 %}
                    {# Monolingual Case #}
                    {% set lang = main_package_languages[0] %}
                    <div class="form-group">
                        <label for="NumSessionsMonolingual">Number of Sessions ({{ lang.LanguageName }})</label>
                        <input type="number" class="form-control" id="NumSessionsMonolingual" name="NumSessionsMonolingual" value="{{ form_data.NumSessionsMonolingual or '0' }}">
                    </div>
                    <div class="form-group">
                        <label for="MonolingualDetails">Details for {{ lang.LanguageName }} Sessions</label>
                        <textarea class="form-control" id="MonolingualDetails" name="MonolingualDetails" rows="3">{{ form_data.MonolingualDetails or '' }}</textarea>
                    </div>

                {% elif main_package_languages|length >= 2 %}
                    {# Bilingual Case - We use the first two languages #}
                    {% set lang1 = main_package_languages[0] %}
                    {% set lang2 = main_package_languages[1] %}
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="NumSessionsMonolingual">Number of Sessions ({{ lang1.LanguageName }})</label>
                            <input type="number" class="form-control" id="NumSessionsMonolingual" name="NumSessionsMonolingual" value="{{ form_data.NumSessionsMonolingual or '0' }}">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="NumSessionsBilingual">Number of Sessions ({{ lang2.LanguageName }})</label>
                            <input type="number" class="form-control" id="NumSessionsBilingual" name="NumSessionsBilingual" value="{{ form_data.NumSessionsBilingual or '0' }}">
                        </div>
                    </div>
                     <div class="form-group">
                        <label for="MonolingualDetails">Details for {{ lang1.LanguageName }} Sessions</label>
                        <textarea class="form-control" id="MonolingualDetails" name="MonolingualDetails" rows="3">{{ form_data.MonolingualDetails or '' }}</textarea>
                    </div>
                    <div class="form-group">
                        <label for="BilingualDetails">Details for {{ lang2.LanguageName }} Sessions</label>
                        <textarea class="form-control" id="BilingualDetails" name="BilingualDetails" rows="3">{{ form_data.BilingualDetails or '' }}</textarea>
                    </div>

                {% else %}
                    <div class="alert alert-warning">
                        Cannot set sessions. The parent Main Package has no languages assigned.
                    </div>
                {% endif %}
                {# --- DYNAMIC SESSION FIELDS END --- #}
                
                <hr>

                <div class="form-group form-check">
                    <input type="checkbox" class="form-check-input" id="IsActive" name="IsActive" {% if form_data.IsActive or sub_package_id is none %}checked{% endif %}>
                    <label class="form-check-label" for="IsActive">Sub-Package is Active</label>
                </div>

                <a href="{{ url_for('package_mgmt_bp.list_all_packages') }}" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">Save Sub-Package</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}