<!-- templates/agency_staff_portal/courses/groups/admin_group_dashboard.html -->
{% extends 'agency_staff_portal/staff_base.html' %}

{% block staff_title %}{{ title }}{% endblock %}

{% block staff_page_title %}
    <i class="bi bi-person-video3"></i> {{ title }}
{% endblock %}

{% block staff_content %}
<div class="space-y-8">
    <!-- Action Buttons -->
    <div class="flex flex-wrap gap-3">
        <a href="{{ url_for('.admin_manage_roster', group_id=group_id) }}" class="btn-primary"><i class="bi bi-people-fill mr-2"></i> Manage Roster</a>
        <a href="{{ url_for('.admin_attendance', group_id=group_id) }}" class="btn-primary"><i class="bi bi-calendar-check mr-2"></i> Take Attendance</a>
        <a href="{{ url_for('.edit_group', group_id=group_id) }}" class="btn-secondary"><i class="bi bi-pencil-fill mr-2"></i> Edit Group Details</a>
    </div>

    <!-- Assessments Section -->
    <div class="bg-white dark:bg-slate-800 shadow-md rounded-lg border dark:border-slate-700">
        <div class="p-4 sm:p-6 border-b dark:border-slate-600 flex justify-between items-center">
            <div>
                <h3 class="text-base font-semibold leading-6 text-gray-900 dark:text-gray-100">Assessments</h3>
                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Quizzes, exams, and assignments for this group.</p>
            </div>
            <div>
                <a href="{{ url_for('.add_group_assessment_admin', group_id=group_id) }}" class="btn-primary"><i class="bi bi-plus-circle mr-1"></i> New Assessment</a>
            </div>
        </div>
        <ul role="list" class="divide-y divide-gray-200 dark:divide-slate-700">
            {% for assessment in assessments %}
            <li class="p-4 sm:p-6 hover:bg-gray-50 dark:hover:bg-slate-800/50" x-data="{ open: false }">
                <div class="flex items-center justify-between">
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-primary-600 dark:text-primary-400 truncate">{{ assessment.Title }}</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400">
                            {{ assessment.AssessmentType }} - Due: {{ assessment.DueDate.strftime('%b %d, %Y') if assessment.DueDate else 'N/A' }}
                        </p>
                    </div>
                    <div class="flex-shrink-0 ml-4">
                         <div @click.away="open = false" class="relative inline-block text-left">
                            <button @click="open = !open" class="btn-secondary !text-xs !py-1">Manage <i class="bi bi-chevron-down"></i></button>
                            <div x-show="open" x-collapse
                                 class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10">
                                <div class="py-1" role="menu">
                                    <a href="{{ url_for('.view_test_results', test_type='assessment', test_id=assessment.AssessmentID) }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">View Results</a>
                                    <a href="{{ url_for('.build_group_assessment_admin', assessment_id=assessment.AssessmentID) }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Build Questions</a>
                                    <a href="{{ url_for('.edit_group_assessment_admin', assessment_id=assessment.AssessmentID) }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Edit Details</a>
                                    <form action="{{ url_for('.delete_group_assessment_admin', assessment_id=assessment.AssessmentID) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this assessment?');">
                                        <button type="submit" class="w-full text-left block px-4 py-2 text-sm text-red-700 hover:bg-gray-100">Delete</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            {% else %}
            <li class="px-6 py-4 text-center text-sm text-gray-500">No assessments have been created for this group.</li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}