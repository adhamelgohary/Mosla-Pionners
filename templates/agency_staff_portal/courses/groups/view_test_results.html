{% extends 'agency_staff_portal/staff_base.html' %}
{% block staff_title %}{{ title }}{% endblock %}
{% block staff_page_title %}<i class="bi bi-graph-up"></i> {{ title }}{% endblock %}
{% block staff_content %}
<a href="{{ url_for('.list_all_tests') }}" class="btn-secondary mb-4"><i class="bi bi-arrow-left"></i> Back to Test Center</a>

<div class="bg-white shadow rounded-lg">
    <div class="p-6 border-b">
        <h3 class="text-lg font-semibold">{{ test_info.Title }}</h3>
        {% if test_info.group_name %}
        <p class="text-sm text-gray-500">Assessment for group: <strong>{{ test_info.group_name }}</strong></p>
        {% else %}
        <p class="text-sm text-gray-500">This is a pre-enrollment Placement Test.</p>
        {% endif %}
    </div>
    <table class="min-w-full divide-y">
        <thead>
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase">Student</th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase">Score / Result</th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase">Date Completed</th>
            </tr>
        </thead>
        <tbody class="divide-y">
            {% for sub in submissions %}
            <tr>
                <td class="px-6 py-4 font-medium">{{ sub.FirstName }} {{ sub.LastName }}</td>
                <td class="px-6 py-4 text-sm">{{ sub.Status }}</td>
                <td class="px-6 py-4 text-sm font-semibold">
                    {% if test_type == 'placement' %}
                        {{ sub.PlacementTestScore or 'Not yet graded' }}
                    {% else %}
                        {{ sub.Score if sub.Score is not none else 'Not yet graded' }}
                    {% endif %}
                </td>
                <td class="px-6 py-4 text-sm text-gray-500">
                    {{ (sub.CompletedAt or sub.GradedAt).strftime('%Y-%m-%d %H:%M') if (sub.CompletedAt or sub.GradedAt) else 'N/A' }}
                </td>
            </tr>
            {% else %}
            <tr><td colspan="4" class="text-center p-6 text-gray-500">No students have been assigned or have taken this test yet.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}