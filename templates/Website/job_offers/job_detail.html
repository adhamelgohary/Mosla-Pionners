{% extends "Website/base.html" %}

{% block title %}{{ offer.Title if offer else 'Job Offer Details' }} - Mosla Pioneers{% endblock %}

{% block content %}
<div class="job-detail-page-wrapper">
    <main class="relative z-10 max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
        
        {% if offer %}
            <!-- Bento Grid Layout Container -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                <!-- Box 1: Header (Spans full width) -->
                <div class="lg:col-span-3 bg-card/90 backdrop-blur-sm p-6 sm:p-8 rounded-2xl shadow-xl border border-border/50">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6">
                        {% if offer.CompanyLogoURL %}
                            <img src="{{ url_for('static', filename=offer.CompanyLogoURL) }}" alt="{{ offer.CompanyName }} Logo" class="w-16 h-16 sm:w-20 sm:h-20 object-contain rounded-xl bg-white p-1 flex-shrink-0 border border-border">
                        {% endif %}
                        <div>
                            <p class="text-sm font-medium text-primary">{{ offer.CategoryName }}</p>
                            <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-heading mt-1">{{ offer.Title }}</h1>
                            <p class="mt-2 text-lg font-medium text-text-muted">{{ offer.CompanyName }}</p>
                        </div>
                    </div>
                </div>

                <!-- Box 2: Main Details (Spans 2 columns on desktop) -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- Key Qualifications Box -->
                    <div class="bg-card/90 backdrop-blur-sm p-6 rounded-2xl shadow-xl border border-border/50">
                        <h3 class="text-xl font-bold text-heading border-b border-border pb-3 mb-4">Key Qualifications</h3>
                        <ul class="space-y-3 text-text-muted list-disc list-outside pl-5">
                            <li><strong>Language Proficiency:</strong> {{ offer.LanguagesType }} candidate with a required level of <strong class="text-text">{{ offer.RequiredLevel }}</strong>. Languages: <strong class="text-text">{{ offer.RequiredLanguages_list|join(', ') if offer.RequiredLanguages_list else 'Not Specified' }}</strong>.</li>
                            <li><strong>Graduation Status:</strong> Open to <strong class="text-text">{{ offer.GraduationStatusRequirement }}</strong>.</li>
                            <li><strong>Nationality:</strong> Open to <strong class="text-text">{{ offer.Nationality }}</strong>.</li>
                            {% if offer.MaxAge %}<li><strong>Age Requirement:</strong> Maximum age of <strong class="text-text">{{ offer.MaxAge }}</strong> years.</li>{% endif %}
                        </ul>
                    </div>

                    <!-- Offer Conditions Box -->
                    <div class="bg-card/90 backdrop-blur-sm p-6 rounded-2xl shadow-xl border border-border/50">
                         <h3 class="text-xl font-bold text-heading border-b border-border pb-3 mb-4">Offer Conditions</h3>
                         <ul class="space-y-3 text-text-muted list-disc list-outside pl-5">
                            <li><strong>Shift Type:</strong> <strong class="text-text">{{ offer.ShiftType|title }} shifts</strong>.
                            {% if offer.AvailableShifts_list %}
                                (Available shifts: {{ offer.AvailableShifts_list|join(', ') }})
                            {% endif %}
                            </li>
                         </ul>
                    </div>
                    
                    <!-- About Company Box -->
                    {% if offer.CompanyDescription %}
                    <div class="bg-card/90 backdrop-blur-sm p-6 rounded-2xl shadow-xl border border-border/50">
                         <h3 class="text-xl font-bold text-heading border-b border-border pb-3 mb-4">About {{ offer.CompanyName }}</h3>
                         <div class="prose prose-lg max-w-none dark:prose-invert prose-p:text-text-muted prose-a:text-primary">
                             <p>{{ offer.CompanyDescription|safe }}</p>
                         </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Box 3: Sidebar "At a Glance" (Spans 1 column on desktop) -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-card/90 backdrop-blur-sm p-6 rounded-2xl shadow-xl border border-border/50">
                        <h3 class="text-xl font-bold text-heading border-b border-border pb-3 mb-4">At a Glance</h3>
                        <div class="space-y-4 text-sm">
                            <div class="flex items-start gap-3"><svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" /></svg> <span class="text-text-muted">{{ offer.Location }}</span></div>
                            <div class="flex items-start gap-3"><svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.826-1.106-2.255 0-3.081a2.5 2.5 0 014.242 0l.879.659" /></svg> <span class="text-text-muted">{{ 'Up to ' ~ offer.NetSalary|int if offer.NetSalary else 'Not Disclosed' }} EGP / {{ offer.PaymentTerm }}</span></div>
                            <div class="flex items-start gap-3"><svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21" /></svg> <span class="text-text-muted">{{ offer.WorkLocationType|replace('wfh', 'Work From Home')|title }}</span></div>
                            <div class="flex items-start gap-3"><svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg> <span class="text-text-muted">{{ offer.InterviewType }} Interview</span></div>
                            <div class="flex items-start gap-3"><svg class="w-5 h-5 text-primary flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9.75h4.875a2.625 2.625 0 010 5.25H12M8.25 9.75L10.5 7.5M8.25 9.75L10.5 12m3.75 7.5H4.125a2.25 2.25 0 01-2.25-2.25V5.25A2.25 2.25 0 014.125 3h15.75A2.25 2.25 0 0122.5 5.25v5.25" /></svg> <span class="text-text-muted">Posted {{ offer.DatePosted|humanize_date }}</span></div>
                        </div>

                        {% if offer.BenefitsIncluded_list %}
                        <div class="pt-4 mt-4 border-t border-border">
                            <h4 class="text-base font-bold text-heading mb-3">Benefits & Perks</h4>
                            <ul class="space-y-2 text-sm text-text-muted list-none">
                                {% for benefit in offer.BenefitsIncluded_list %}
                                    <li class="flex items-center gap-2">
                                        <svg class="w-4 h-4 text-success-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" /></svg>
                                        <span>{{ benefit }}</span>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>

            </div> <!-- End Bento Grid -->

            <div class="mt-10 text-center">
                <a href="{{ url_for('job_board_bp.job_offers_list') }}" class="text-sm font-semibold text-primary hover:text-primary-darker">← Back to All Job Offers</a>
            </div>

        {% else %}
             <div class="text-center py-10">
                <h2 class="text-xl font-bold text-heading">Job Offer Not Found</h2>
                <p class="mt-2 text-text-muted">This offer may no longer be available.</p>
                <a href="{{ url_for('job_board_bp.job_offers_list') }}" class="mt-6 inline-block rounded-md bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-darker">← View Other Job Offers</a>
            </div>
        {% endif %}
    </main>
</div>

<!-- Sticky Apply Bar -->
<div class="fixed bottom-0 left-0 w-full bg-gray-900/90 backdrop-blur-lg border-t border-white/10 shadow-2xl z-50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-4 py-3">
            <div class="text-center sm:text-left">
                <h4 class="font-bold text-white text-base sm:text-lg hidden sm:block">{{ offer.Title }}</h4>
                <p class="text-sm text-gray-300">{{ offer.CompanyName }} • {{ offer.Location }}</p>
            </div>
            <div class="flex-shrink-0 w-full sm:w-auto">
                {% if current_user.is_authenticated and current_user.role_type == 'Candidate' %}
                    <a href="{{ url_for('job_board_bp.apply_to_job', offer_id=offer.OfferID) }}" class="block w-full text-center rounded-lg bg-primary px-6 py-3 text-base font-semibold text-white shadow-sm hover:bg-primary-darker focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary">Apply Now</a>
                {% else %}
                    <a href="{{ url_for('login_bp.login', next=url_for('job_board_bp.apply_to_job', offer_id=offer.OfferID)) }}" class="block w-full text-center rounded-lg bg-primary px-6 py-3 text-base font-semibold text-white shadow-sm hover:bg-primary-darker">Login to Apply</a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const stickyBar = document.querySelector('.fixed.bottom-0');
        const mainContent = document.querySelector('main');
        function updateContentPadding() {
            if (stickyBar && mainContent) {
                const barHeight = stickyBar.offsetHeight;
                mainContent.style.paddingBottom = (barHeight + 40) + 'px';
            }
        }
        updateContentPadding();
        window.addEventListener('resize', updateContentPadding);
    });
</script>
{% endblock %}

{% block footer %}{% endblock footer %}