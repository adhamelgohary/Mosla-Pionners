{% extends "Website/base.html" %}

{% block title %}{{ title }} - Mosla Pioneers{% endblock %}

{% block head_extra %}
    {{ super() }}
    {# We no longer need offer_styles.css because Tailwind handles everything now #}
{% endblock %}

{% block content %}
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Search and Filter Form -->
    <form class="bg-card p-6 sm:p-8 rounded-2xl shadow-lg mb-8" method="GET" action="{{ url_for('job_board_bp.job_offers_list') }}">
        <h1 class="text-2xl sm:text-3xl font-bold text-heading mb-6">Find Your Next Opportunity</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <!-- Keyword Search -->
            <div class="relative">
                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <svg class="h-5 w-5 text-text-muted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" /></svg>
                </div>
                <input type="text" name="q" placeholder="Job title, keywords, or company" value="{{ search_term or '' }}"
                       class="block w-full rounded-lg border-input-border bg-input pl-10 pr-3 py-2.5 text-text focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
            <!-- Location Search -->
            <div class="relative">
                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <svg class="h-5 w-5 text-text-muted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.1.4-.27.6-.5s.4-.5.5-.868c.1-.368.1-.9.1-1.469V10.5a3 3 0 00-3-3V3.375C5.25 3.375 3 5.625 3 8.375v1.369a5.741 5.741 0 00.281.14c.186.1.4.27.6.5s.4.5.5.868c.1.368.1.9.1-1.469V8.375a3 3 0 013-3v3.125c.75 0 1.5.25 2.125.625A2.982 2.982 0 0115 10.5v2.639c0 .57.005 1.102-.1 1.469-.1.368-.205.668-.5.868-.2.2-.415.399-.6.5a5.741 5.741 0 00-.281.14l-.018.008-.006.003zM10 16.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" clip-rule="evenodd" /></svg>
                </div>
                <input type="text" name="location" placeholder="Location (e.g., Cairo)" value="{{ selected_location or '' }}"
                       class="block w-full rounded-lg border-input-border bg-input pl-10 pr-3 py-2.5 text-text focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
        </div>

        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <!-- Active Filters -->
            <div class="flex flex-wrap gap-2 items-center">
                {% if search_term or selected_category_id or selected_location %}
                    <span class="text-sm font-medium text-text-muted">Active:</span>
                {% endif %}
                {% if search_term %}<span class="inline-flex items-center gap-x-1.5 rounded-md px-2 py-1 text-xs font-medium text-text-muted ring-1 ring-inset ring-border">Keyword: {{ search_term }} <a href="{{ url_for('.job_offers_list', category=selected_category_id, location=selected_location) }}" class="ml-1 text-danger-500 hover:text-danger-700" title="Clear keyword">×</a></span>{% endif %}
                {% if selected_category_id %}{% set category_name_display = "Unknown" %}{% for cat in job_categories %}{% if cat.CategoryID == selected_category_id %}{% set category_name_display = cat.CategoryName %}{% endif %}{% endfor %}<span class="inline-flex items-center gap-x-1.5 rounded-md px-2 py-1 text-xs font-medium text-text-muted ring-1 ring-inset ring-border">Category: {{ category_name_display }} <a href="{{ url_for('.job_offers_list', q=search_term, location=selected_location) }}" class="ml-1 text-danger-500 hover:text-danger-700" title="Clear category">×</a></span>{% endif %}
                {% if selected_location %}<span class="inline-flex items-center gap-x-1.5 rounded-md px-2 py-1 text-xs font-medium text-text-muted ring-1 ring-inset ring-border">Location: {{ selected_location }} <a href="{{ url_for('.job_offers_list', q=search_term, category=selected_category_id) }}" class="ml-1 text-danger-500 hover:text-danger-700" title="Clear location">×</a></span>{% endif %}
            </div>
            <!-- Action Buttons -->
            <div class="flex items-center gap-4 w-full sm:w-auto">
                {% if search_term or selected_category_id or selected_location %}
                    {# MODIFIED: Added dark mode text color for better contrast #}
                    <a href="{{ url_for('.job_offers_list') }}" class="w-full sm:w-auto text-center text-sm font-semibold text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300">Clear All</a>
                {% endif %}
                {# MODIFIED: Primary button style is generally robust, but ensuring text is white is good. #}
                <button type="submit" class="w-full sm:w-auto rounded-lg bg-primary px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primary-darker focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary">Search</button>
            </div>
        </div>
    </form>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        <!-- Sidebar -->
        <aside class="hidden lg:block lg:col-span-1">
            <div class="bg-card p-6 rounded-2xl shadow-lg sticky top-28">
                <h3 class="text-lg font-semibold text-heading mb-4">Job Categories</h3>
                <nav class="flex flex-col gap-1">
                    {# MODIFIED: Improved colors for active and inactive states in both modes #}
                    <a href="{{ url_for('.job_offers_list', q=search_term, location=selected_location) }}"
                       class="px-3 py-2 text-sm font-medium rounded-md transition-colors
                              {% if not selected_category_id %}bg-primary-100 text-primary-700 dark:bg-primary-500/20 dark:text-primary-300{% else %}text-text-muted hover:bg-gray-100 dark:hover:bg-white/5 hover:text-primary-600 dark:hover:text-primary-400{% endif %}">
                        All Categories
                    </a>
                    {% for category in job_categories %}
                    <a href="{{ url_for('.job_offers_list', category=category.CategoryID, q=search_term, location=selected_location) }}"
                       class="px-3 py-2 text-sm font-medium rounded-md transition-colors
                              {% if selected_category_id == category.CategoryID %}bg-primary-100 text-primary-700 dark:bg-primary-500/20 dark:text-primary-300{% else %}text-text-muted hover:bg-gray-100 dark:hover:bg-white/5 hover:text-primary-600 dark:hover:text-primary-400{% endif %}">
                        {{ category.CategoryName }}
                    </a>
                    {% endfor %}
                </nav>
            </div>
        </aside>

        <!-- Job Listings -->
        <div class="lg:col-span-3">
            <div class="border-b border-border pb-4 mb-6">
                <h2 class="text-xl font-bold text-heading">Available Job Openings</h2>
                <p class="mt-1 text-sm text-text-muted">
                    Showing {{ job_offers_list|length }} job opening{{ 's' if job_offers_list|length != 1 else '' }}
                    {% if search_term or selected_category_id or selected_location %} (filtered results){% endif %}
                </p>
            </div>

            <div class="flex flex-col gap-6">
                {% if job_offers_list %}
                    {% for job in job_offers_list %}
                    <a href="{{ url_for('job_board_bp.job_detail', offer_id=job.OfferID) }}" class="block bg-card p-6 rounded-2xl border border-border hover:border-primary hover:shadow-xl transition-all duration-300 group">
                        <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
                            <!-- Job Info -->
                            <div class="flex-grow">
                                <p class="text-sm text-text-muted mb-1">
                                    {{ job.JobType or 'Full-time' }} • Posted {{ job.DatePosted | timeago }}
                                </p>
                                <h3 class="text-lg font-semibold text-heading group-hover:text-primary transition-colors">{{ job.Title }}</h3>
                                {# MODIFIED: Use a specific primary color shade for dark mode contrast #}
                                <p class="text-base font-medium text-primary-600 dark:text-primary-400 mt-1">{{ job.CompanyName }}</p>
                                <p class="text-sm text-text-muted mt-2">
                                    {% if job.NetSalary %}{{ job.NetSalary | currency(job.Currency or 'EGP') }} / Monthly{% else %}Salary Undisclosed{% endif %}
                                </p>
                            </div>
                            <!-- Action Button (visible on hover) -->
                            <div class="w-full sm:w-auto flex justify-end items-start mt-4 sm:mt-0">
                               {# MODIFIED: Explicit colors for light/dark mode #}
                               <span class="hidden sm:inline-block rounded-md bg-primary-100 text-primary-700 dark:bg-primary-500/20 dark:text-primary-300 px-4 py-2 text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity">View Details</span>
                            </div>
                        </div>
                        <!-- Tags -->
                        <div class="flex flex-wrap gap-2 mt-4 pt-4 border-t border-border">
                            {# MODIFIED: Replaced custom tag classes with standard, dark-mode aware Tailwind classes for high contrast #}
                            {% if job.Location %}<span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/70 dark:text-blue-200">🌍 {{ job.Location }}</span>{% endif %}
                            {% if job.CategoryName %}<span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/70 dark:text-green-200">{{ job.CategoryName }}</span>{% endif %}
                            {% if job.EnglishLevelRequirement %}<span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/70 dark:text-purple-200">🇬🇧 {{ job.EnglishLevelRequirement }}</span>{% endif %}
                        </div>
                    </a>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-16 px-6 bg-card rounded-2xl">
                        <svg class="mx-auto h-12 w-12 text-text-muted" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" /></svg>
                        <h3 class="mt-2 text-lg font-semibold text-heading">No jobs found</h3>
                        <p class="mt-1 text-sm text-text-muted">No jobs were found matching your criteria. Try broadening your search.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</main>
{% endblock %}