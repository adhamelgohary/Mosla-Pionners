{% extends "Website/base.html" %}

{% block title %}{{ title }} - Mosla Pioneers{% endblock %}

{% block head_extra %}
    {{ super() }}
    {# Link to your custom CSS if it's not already in base.html #}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/offer_styles.css') }}">
{% endblock %}

{% block content %}
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Search and Filter Form -->
    <form class="bg-card p-6 sm:p-8 rounded-2xl shadow-lg mb-8" method="GET" action="{{ url_for('job_board_bp.job_offers_list') }}">
        <h1 class="text-2xl sm:text-3xl font-bold text-heading mb-6">Find Your Next Opportunity</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <!-- Keyword Search -->
            <div class="relative">
                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <svg class="h-5 w-5 text-text-muted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" /></svg>
                </div>
                <input type="text" name="q" placeholder="Job title, keywords, or company" value="{{ search_term or '' }}"
                       class="block w-full rounded-lg border-input-border bg-input pl-10 pr-3 py-2.5 text-text focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
            <!-- Location Search -->
            <div class="relative">
                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                    <svg class="h-5 w-5 text-text-muted" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.69 18.933l.003.001C9.89 19.02 10 19 10 19s.11.02.308-.066l.002-.001.006-.003.018-.008a5.741 5.741 0 00.281-.14c.186-.1.4-.27.6-.5s.4-.5.5-.868c.1-.368.1-.9.1-1.469V10.5a3 3 0 00-3-3V3.375C5.25 3.375 3 5.625 3 8.375v1.369a5.741 5.741 0 00.281.14c.186.1.4-.27.6.5s.4-.5.5.868c.1.368.1.9.1-1.469V8.375a3 3 0 013-3v3.125c.75 0 1.5.25 2.125.625A2.982 2.982 0 0115 10.5v2.639c0 .57.005 1.102-.1 1.469-.1.368-.205.668-.5.868-.2.2-.415.399-.6.5a5.741 5.741 0 00-.281.14l-.018.008-.006.003zM10 16.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" clip-rule="evenodd" /></svg>
                </div>
                <input type="text" name="location" placeholder="Location (e.g., Cairo)" value="{{ selected_location or '' }}"
                       class="block w-full rounded-lg border-input-border bg-input pl-10 pr-3 py-2.5 text-text focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
        </div>

        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <div class="flex-grow"></div> {# This can be used for active filter chips if needed #}
            <div class="flex items-center gap-4 w-full sm:w-auto">
                {% if search_term or selected_category_id or selected_location %}
                    <a href="{{ url_for('.job_offers_list') }}" class="w-full sm:w-auto text-center text-sm font-semibold text-primary hover:text-primary-darker">Clear All</a>
                {% endif %}
                <button type="submit" class="w-full sm:w-auto rounded-lg bg-primary px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-primary-darker focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary">Search</button>
            </div>
        </div>
    </form>

    <div class="job-board-container">
        <aside class="sidebar job-filters">
            <div class="job-categories">
                <h3>Job Categories</h3>
                <a href="{{ url_for('.job_offers_list', q=search_term, location=selected_location) }}" class="category-item">
                    <div class="category-info">
                        <span class="category-name">All Categories</span>
                    </div>
                </a>
                {% for category in job_categories %}
                <a href="{{ url_for('.job_offers_list', category=category.CategoryID, q=search_term, location=selected_location) }}" class="category-item">
                    <div class="category-info">
                        <span class="category-name">{{ category.CategoryName }}</span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </aside>

        <div class="main-content job-listings">
            <div class="job-list-header">
                <div>
                    <h2 class="section-title">Available Job Openings</h2>
                    <p class="section-subtitle">
                        Showing {{ job_offers_list|length }} job opening{{ 's' if job_offers_list|length != 1 else '' }}
                        {% if search_term or selected_category_id or selected_location %} (filtered results){% endif %}
                    </p>
                </div>
            </div>

            <div class="job-list">
                {% if job_offers_list %}
                    {% for job in job_offers_list %}
                    <a href="{{ url_for('job_board_bp.job_detail', offer_id=job.OfferID) }}" class="job-card">
                        <div class="job-header">
                            <div>
                                <h3 class="job-title">{{ job.Title }}</h3>
                                <p class="job-company">{{ job.CompanyName }}</p>
                                <p class="job-salary">
                                    {% if job.NetSalary %}{{ job.NetSalary | currency(job.Currency or 'EGP') }} / Monthly{% else %}Salary Undisclosed{% endif %}
                                </p>
                            </div>
                        </div>
                        <!-- FIX: Using the classes from your CSS files -->
                        <div class="job-tags">
                            {% if job.Location %}<span class="job-tag location">üåç {{ job.Location }}</span>{% endif %}
                            {% if job.CategoryName %}<span class="job-tag category">{{ job.CategoryName }}</span>{% endif %}
                            {% if job.EnglishLevelRequirement %}<span class="job-tag english-level">üá¨üáß {{ job.EnglishLevelRequirement }}</span>{% endif %}
                        </div>
                    </a>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-16 px-6 bg-card rounded-2xl">
                        <svg class="mx-auto h-12 w-12 text-text-muted" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" /></svg>
                        <h3 class="mt-2 text-lg font-semibold text-heading">No jobs found</h3>
                        <p class="mt-1 text-sm text-text-muted">No jobs were found matching your criteria. Try broadening your search.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</main>
{% endblock %}