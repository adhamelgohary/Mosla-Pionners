{# templates/recruiter_team_portal/my_profile.html #}
{% extends "recruiter_team_portal/recruiter_base.html" %}

{% block recruiter_title %}{{ title }}{% endblock %}
{% block recruiter_page_title %}<i class="bi bi-person-circle text-text-muted"></i><span>{{ title }}</span>{% endblock %}

{% block recruiter_content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- Left Column: Forms -->
    <div class="lg:col-span-2 space-y-8">
        <!-- Edit Profile Details Form -->
        <div class="bg-card p-6 rounded-lg shadow border border-border">
            <h2 class="text-lg font-semibold text-heading">Profile Information</h2>
            <p class="mt-1 text-sm text-text-muted">Update your personal details here.</p>
            <form action="{{ url_for('dashboard_bp.my_profile') }}" method="POST" class="mt-6 space-y-6">
                <input type="hidden" name="action" value="update_details">

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <label for="first_name" class="form-label">First Name</label>
                        <input type="text" id="first_name" name="first_name" value="{{ user_data.FirstName }}" class="form-input">
                    </div>
                    <div>
                        <label for="last_name" class="form-label">Last Name</label>
                        <input type="text" id="last_name" name="last_name" value="{{ user_data.LastName }}" class="form-input">
                    </div>
                </div>
                <div>
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" id="email" name="email" value="{{ user_data.Email }}" class="form-input">
                </div>
                <div>
                    <label for="phone_number" class="form-label">Phone Number</label>
                    <input type="tel" id="phone_number" name="phone_number" value="{{ user_data.PhoneNumber or '' }}" class="form-input">
                </div>
                <div class="text-right">
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>

        <!-- Change Password Form -->
        <div class="bg-card p-6 rounded-lg shadow border border-border">
            <h2 class="text-lg font-semibold text-heading">Change Password</h2>
            <p class="mt-1 text-sm text-text-muted">Ensure your account is using a long, random password to stay secure.</p>
            <form action="{{ url_for('dashboard_bp.my_profile') }}" method="POST" class="mt-6 space-y-6">
                <input type="hidden" name="action" value="change_password">
                <div>
                    <label for="current_password" class="form-label">Current Password</label>
                    <input type="password" id="current_password" name="current_password" required class="form-input">
                </div>
                <div>
                    <label for="new_password" class="form-label">New Password</label>
                    <input type="password" id="new_password" name="new_password" required class="form-input">
                </div>
                <div>
                    <label for="confirm_password" class="form-label">Confirm New Password</label>
                    <input type="password" id="confirm_password" name="confirm_password" required class="form-input">
                </div>
                <div class="text-right">
                    <button type="submit" class="btn-secondary">Update Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Right Column: Role and Referral Code -->
    <div class="lg:col-span-1 space-y-8">
        <div class="bg-card p-6 rounded-lg shadow border border-border">
            <h2 class="text-lg font-semibold text-heading">Your Role</h2>
            <p class="mt-2 text-3xl font-bold text-primary">{{ user_data.Role }}</p>
            <p class="mt-1 text-sm text-text-muted">Your permissions are determined by this role.</p>
        </div>

        <div class="bg-card p-6 rounded-lg shadow border border-border">
            <h2 class="text-lg font-semibold text-heading">Referral Code</h2>
            {% if user_data.ReferralCode %}
                <div x-data="{ code: '{{ user_data.ReferralCode }}', copied: false }" class="mt-2">
                    <div class="flex items-center justify-between p-3 bg-background rounded-md border border-border">
                        <p id="referralCode" class="text-2xl font-mono font-bold text-heading tracking-widest" x-text="code"></p>
                        <button @click="navigator.clipboard.writeText(code); copied = true; setTimeout(() => copied = false, 2000)" class="btn-secondary" title="Copy to clipboard">
                            <i class="bi" :class="copied ? 'bi-check-lg text-green-500' : 'bi-clipboard'"></i>
                        </button>
                    </div>
                    <p x-show="copied" x-transition class="text-xs text-green-600 mt-1">Copied!</p>
                </div>
                <p class="mt-2 text-sm text-text-muted">Share this code with candidates to link their applications to you.</p>
            {% else %}
                <p class="mt-2 text-sm text-text-muted">You have not generated a referral code yet.</p>
                <form action="{{ url_for('dashboard_bp.my_profile') }}" method="POST" class="mt-4">
                    <input type="hidden" name="action" value="generate_code">
                    <button type="submit" class="btn-primary w-full">Generate My Code</button>
                </form>
            {% endif %}
        </div>
    </div>

</div>
{% endblock %}