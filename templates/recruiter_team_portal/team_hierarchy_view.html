{% extends "recruiter_team_portal/recruiter_base.html" %}

{% block recruiter_title %}{{ title }}{% endblock %}

{% block recruiter_page_title_icon %}
<i class="bi bi-person-video3 text-2xl text-primary"></i>
{% endblock %}

{% block recruiter_page_title %}{{ title }}{% endblock %}

{% block recruiter_content %}
{% if breadcrumbs %}
<nav class="flex" aria-label="Breadcrumb">
  <ol role="list" class="flex items-center space-x-4 mb-6">
    <li>
      <div>
        <a href="{{ url_for('dashboard_bp.dashboard') }}" class="text-text-secondary hover:text-text"><i class="bi bi-house-door-fill"></i><span class="sr-only">Home</span></a>
      </div>
    </li>
    {% for crumb in breadcrumbs %}
    <li>
      <div class="flex items-center">
        <i class="bi bi-chevron-right flex-shrink-0 h-5 w-5 text-gray-400"></i>
        <a href="{{ crumb.url or '#' }}" class="ml-4 text-sm font-medium {{ 'text-text' if not crumb.url else 'text-text-secondary hover:text-text' }}" {{ 'aria-current="page"' if not crumb.url else '' }}>
          {{ crumb.name }}
        </a>
      </div>
    </li>
    {% endfor %}
  </ol>
</nav>
{% endif %}

<div class="space-y-8">
    <!-- Management Actions (if applicable) -->
    {% if unassigned_recruiters or teams_in_unit %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {% if current_user.role_type == 'SourcingTeamLead' or current_user.role_type == 'UnitManager' %}
        <!-- Assign Recruiter to a Team -->
        <div class="bg-card shadow rounded-lg p-6">
            <h3 class="text-lg font-medium text-heading">Assign Recruiter to Team</h3>
            {% if unassigned_recruiters and assignable_teams %}
                <form action="{{ url_for('organization_bp.assign_recruiter_to_team') }}" method="POST" class="mt-4 space-y-4">
                    <div>
                        <label for="recruiter_staff_id" class="form-label">Unassigned Recruiter</label>
                        <select name="recruiter_staff_id" id="recruiter_staff_id" class="form-input" required>
                            <option value="">Select a recruiter...</option>
                            {% for r in unassigned_recruiters %}
                            <option value="{{ r.StaffID }}">{{ r.FirstName }} {{ r.LastName }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="team_id" class="form-label">Your Team(s)</label>
                        <select name="team_id" id="team_id" class="form-input" required>
                            <option value="">Select a team...</option>
                            {% for t in assignable_teams %}
                            <option value="{{ t.TeamID }}">{{ t.TeamName }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="flex justify-end">
                        <button type="submit" class="btn btn-primary">Assign Recruiter</button>
                    </div>
                </form>
            {% else %}
                <p class="mt-4 text-sm text-text-secondary">No unassigned recruiters or assignable teams found.</p>
            {% endif %}
        </div>
        {% endif %}

        {% if current_user.role_type == 'UnitManager' %}
        <!-- Assign Team Lead -->
        <div class="bg-card shadow rounded-lg p-6">
            <h3 class="text-lg font-medium text-heading">Assign Team Lead</h3>
            {% if potential_team_leads and teams_in_unit %}
            <form action="{{ url_for('organization_bp.assign_team_lead') }}" method="POST" class="mt-4 space-y-4">
                <div>
                    <label for="lead_staff_id" class="form-label">Potential Lead</label>
                    <select name="lead_staff_id" id="lead_staff_id" class="form-input" required>
                        <option value="">Select staff...</option>
                        {% for lead in potential_team_leads %}
                            <option value="{{ lead.StaffID }}">{{ lead.FirstName }} {{ lead.LastName }} ({{ lead.Role }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="assign_lead_team_id" class="form-label">Team in your Unit</label>
                    <select name="team_id" id="assign_lead_team_id" class="form-input" required>
                        <option value="">Select team...</option>
                        {% for team in teams_in_unit %}
                            <option value="{{ team.TeamID }}">
                                {{ team.TeamName }} (Current: {{ team.LeadFirstName or 'None' }})
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="btn btn-primary">Assign Lead</button>
                </div>
            </form>
            {% else %}
            <p class="mt-4 text-sm text-text-secondary">No potential leads or teams found in your unit.</p>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Team Members List -->
    <div class="bg-card shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-heading">Direct Reports for {{ current_leader.FirstName }} {{ current_leader.LastName }}</h3>
            <p class="mt-1 max-w-2xl text-sm text-text-secondary">Showing direct reports and their key performance stats.</p>
        </div>
        <ul role="list" class="divide-y divide-gray-200 dark:divide-slate-700">
            {% for member in team_members %}
            <li class="p-4 sm:p-6 hover:bg-background-hover">
                <div class="flex items-center space-x-4">
                    <div class="flex-shrink-0">
                        <img class="h-12 w-12 rounded-full object-cover" src="{{ member.ProfilePictureURL or url_for('static', filename='images/default-profile.png') }}" alt="">
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-base font-medium text-heading truncate">{{ member.FirstName }} {{ member.LastName }}</p>
                        <p class="text-sm text-primary truncate">{{ member.UnitName or member.TeamName or member.Role }}</p>
                    </div>
                    <div class="hidden md:flex items-center gap-x-6 text-center">
                        <div>
                            <p class="text-sm font-medium text-text-secondary">Hires</p>
                            <p class="text-lg font-bold text-heading">{{ member.total_hires }}</p>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-text-secondary">Referrals</p>
                            <p class="text-lg font-bold text-heading">{{ member.total_referrals }}</p>
                        </div>
                    </div>
                    {% if member.Role in ['UnitManager', 'SourcingTeamLead'] %}
                    <a href="{{ url_for('organization_bp.team_view', leader_staff_id=member.StaffID) }}" class="inline-flex items-center shadow-sm px-3 py-2 border border-gray-300 dark:border-slate-600 text-sm leading-4 font-medium rounded-md text-text bg-secondary hover:bg-gray-100 dark:hover:bg-slate-700">
                        View Team <i class="bi bi-arrow-right ml-2"></i>
                    </a>
                    {% endif %}
                </div>
            </li>
            {% else %}
            <li class="p-6 text-center text-text-secondary">No team members or direct reports found.</li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}