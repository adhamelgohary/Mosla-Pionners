{% extends "recruiter_team_portal/recruiter_base.html" %}

{% block recruiter_title %}Manage Team: {{ team.TeamName }}{% endblock %}

{% block recruiter_page_title_icon %}
<i class="bi bi-people-fill text-2xl text-primary"></i>
{% endblock %}

{% block recruiter_page_title %}Manage Team: {{ team.TeamName }}{% endblock %}

{% block recruiter_content %}
<div class="space-y-8">
    <!-- Team Info -->
    <div class="bg-card shadow rounded-lg p-6">
        <p class="text-sm text-text-secondary">Unit: <a href="{{ url_for('organization_bp.manage_unit', unit_id=team.UnitID) }}" class="text-primary hover:underline">{{ team.UnitName }}</a></p>
        <h3 class="text-lg font-medium text-heading mt-1">
            Team Lead: 
            {% if team.LeadFirstName %}
                {{ team.LeadFirstName }} {{ team.LeadLastName }}
            {% else %}
                <span class="font-normal text-yellow-600">Not Assigned</span>
            {% endif %}
        </h3>
    </div>

    <!-- Management Actions (Conditional) -->
    {% if current_user.role_type in ['SourcingTeamLead', 'UnitManager', 'HeadUnitManager', 'CEO', 'Founder'] %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Assign Team Lead -->
        {% if current_user.role_type in ['UnitManager', 'HeadUnitManager', 'CEO', 'Founder'] %}
        <div class="bg-card shadow rounded-lg p-6">
            <h3 class="text-lg font-medium text-heading">Assign Team Lead</h3>
            <form action="{{ url_for('organization_bp.assign_team_lead') }}" method="POST" class="mt-4 space-y-4">
                <input type="hidden" name="team_id" value="{{ team.TeamID }}">
                <div>
                    <label for="lead_staff_id" class="form-label">Select a Lead</label>
                    <select name="lead_staff_id" id="lead_staff_id" class="form-input" required>
                        <option value="">Select a staff member...</option>
                        {% for lead in potential_team_leads %}
                            <option value="{{ lead.StaffID }}" {% if team.TeamLeadStaffID == lead.StaffID %}selected{% endif %}>{{ lead.FullName }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="btn btn-primary">Assign Lead</button>
                </div>
            </form>
        </div>
        {% endif %}

        <!-- Assign Recruiter to this Team -->
        <div class="bg-card shadow rounded-lg p-6">
            <h3 class="text-lg font-medium text-heading">Add Recruiter to Team</h3>
            {% if unassigned_recruiters %}
            <form action="{{ url_for('organization_bp.assign_recruiter_to_team') }}" method="POST" class="mt-4 space-y-4">
                <input type="hidden" name="team_id" value="{{ team.TeamID }}">
                <div>
                    <label for="recruiter_staff_id" class="form-label">Unassigned Recruiter</label>
                    <select name="recruiter_staff_id" id="recruiter_staff_id" class="form-input" required>
                        <option value="">Select a recruiter...</option>
                        {% for recruiter in unassigned_recruiters %}
                        <option value="{{ recruiter.StaffID }}">{{ recruiter.FirstName }} {{ recruiter.LastName }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="btn btn-primary">Add to Team</button>
                </div>
            </form>
            {% else %}
            <p class="mt-4 text-sm text-text-secondary">No unassigned recruiters available to add.</p>
            {% endif %}
        </div>
    </div>
    {% endif %}


    <!-- Team Members List -->
    <div class="bg-card shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
            <h3 class="text-lg leading-6 font-medium text-heading">Team Members</h3>
        </div>
        <div class="border-t border-gray-200 dark:border-slate-700">
            <ul role="list" class="divide-y divide-gray-200 dark:divide-slate-700">
                {% for member in team_members %}
                <li class="p-4 sm:p-6 hover:bg-background-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-base font-medium text-heading">{{ member.FirstName }} {{ member.LastName }}</p>
                            <p class="text-sm text-primary">{{ member.Role }}</p>
                        </div>
                        {# A "Remove" button would go here if a backend route existed for it. #}
                    </div>
                </li>
                {% else %}
                <li class="p-6 text-center text-text-secondary">This team has no members.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}