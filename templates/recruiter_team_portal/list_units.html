{# templates/recruiter_team_portal/list_units.html #}
{% extends "recruiter_team_portal/recruiter_base.html" %}

{% block recruiter_title %}{{ title }}{% endblock %}
{% block recruiter_page_title %}<i class="bi bi-diagram-3-fill text-text-muted"></i><span>{{ title }}</span>{% endblock %}

{% block recruiter_content %}
<div class="space-y-8">

    <!-- Section 1: Create Unit -->
    <div class="bg-card p-6 rounded-lg shadow border border-border">
        <h2 class="text-lg font-semibold text-heading">Create a New Unit</h2>
        <p class="mt-1 text-sm text-text-muted">Units are the highest-level containers in the sourcing division, managed by a Unit Manager.</p>
        <form action="{{ url_for('recruiter_bp.create_unit') }}" method="POST" class="mt-4 flex flex-col sm:flex-row gap-2">
            <input type="text" name="unit_name" required placeholder="New Unit Name (e.g., 'Alpha Unit')" class="form-input flex-grow">
            <button type="submit" class="btn-primary">Create Unit</button>
        </form>
    </div>

    <!-- Section 2: Manage Existing Units -->
    <div class="bg-card rounded-lg shadow border border-border overflow-hidden">
        <div class="p-6">
            <h2 class="text-lg font-semibold text-heading">Manage Units</h2>
            <p class="mt-1 text-sm text-text-muted">Assign managers to units and navigate to manage their teams.</p>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm divide-y divide-border">
                <thead class="bg-background">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider">Unit Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider">Unit Manager</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider" colspan="2">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border">
                    {% for unit in units %}
                    <tr class="hover:bg-background/50">
                        <td class="px-6 py-4 whitespace-nowrap font-medium text-heading">{{ unit.UnitName }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-text">
                            {{ unit.FirstName + ' ' + unit.LastName if unit.FirstName else 'N/A' }}
                            {% if not unit.UnitManagerStaffID %}
                                <span class="ml-2 text-xs font-semibold rounded-full bg-warning/10 text-amber-700 px-2 py-0.5">
                                    <i class="bi bi-exclamation-triangle-fill"></i> No Manager
                                </span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <form action="{{ url_for('recruiter_bp.assign_unit_manager') }}" method="POST" class="flex gap-2 items-center">
                                <input type="hidden" name="unit_id" value="{{ unit.UnitID }}">
                                <select name="manager_staff_id" class="form-select text-xs py-1" required>
                                    <option value="" disabled selected>-- Assign Manager --</option>
                                    {% for manager in potential_managers %}
                                        <option value="{{ manager.StaffID }}" {% if manager.StaffID == unit.UnitManagerStaffID %}selected{% endif %}>{{ manager.FullName }} ({{ manager.Role }})</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="btn-secondary">Assign</button>
                            </form>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right">
                           <a href="{{ url_for('recruiter_bp.manage_unit', unit_id=unit.UnitID) }}" class="btn-primary">Manage Teams Â»</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="4" class="text-center py-10 text-text-muted">No units created yet.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}