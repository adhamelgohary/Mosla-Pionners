{# templates/recruiter_team_portal/manage_unit.html #}
{% extends "recruiter_team_portal/recruiter_base.html" %}

{% block recruiter_title %}{{ title }}{% endblock %}
{% block recruiter_page_title %}
    <div class="flex items-center gap-2 text-text-muted">
        <i class="bi bi-diagram-3-fill"></i>
        <a href="{{ url_for('recruiter_bp.list_units') }}" class="hover:underline">Units</a>
        <span>/</span>
        <span class="text-heading font-semibold">{{ unit.UnitName }}</span>
        {% if not unit.IsActive %}<span class="ml-2 text-xs font-semibold text-danger">(Inactive)</span>{% endif %}
    </div>
{% endblock %}

{% block recruiter_content %}
<div class="space-y-8">
    <!-- Section 1: Create Team for this Unit -->
    <div class="bg-card p-6 rounded-lg shadow border border-border {% if not unit.IsActive %}opacity-50 pointer-events-none{% endif %}">
        <h2 class="text-lg font-semibold text-heading">Create a New Team in {{ unit.UnitName }}</h2>
        <p class="mt-1 text-sm text-text-muted">Teams are groups of recruiters led by a Team Lead, and they belong to a Unit.</p>
        <form action="{{ url_for('recruiter_bp.create_team') }}" method="POST" class="mt-4 flex flex-col sm:flex-row gap-2">
            <input type="hidden" name="unit_id" value="{{ unit.UnitID }}">
            <input type="text" name="team_name" required placeholder="New Team Name (e.g., 'Phoenix Team')" class="form-input flex-grow">
            <button type="submit" class="btn-primary">Create Team</button>
        </form>
    </div>

    <!-- Section 2: Manage Teams in this Unit -->
    <div class="bg-card rounded-lg shadow border border-border overflow-hidden">
        <div class="p-6 flex justify-between items-center">
            <div>
                <h2 class="text-lg font-semibold text-heading">Manage Teams</h2>
                <p class="mt-1 text-sm text-text-muted">Assign leads and recruiters to teams within {{ unit.UnitName }}.</p>
            </div>
            <!-- [NEW] Toggle Link -->
            <div>
                {% if show_all %}
                    <a href="{{ url_for('recruiter_bp.manage_unit', unit_id=unit.UnitID) }}" class="text-xs font-medium text-text-muted hover:text-primary transition">Show Active Only</a>
                {% else %}
                    <a href="{{ url_for('recruiter_bp.manage_unit', unit_id=unit.UnitID, show_all='true') }}" class="text-xs font-medium text-text-muted hover:text-primary transition">Show Inactive Teams</a>
                {% endif %}
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm divide-y divide-border">
                <thead class="bg-background">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider">Team Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider">Team Lead</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-text-muted uppercase tracking-wider" colspan="2">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border">
                    {% for team in teams_in_unit %}
                    <tr class="hover:bg-background/50 {{ 'opacity-50 bg-slate-50 dark:bg-slate-800' if not team.IsActive }}">
                        <td class="px-6 py-4 whitespace-nowrap font-medium text-heading">
                            {{ team.TeamName }}
                            {% if not team.IsActive %}<span class="ml-2 text-xs font-semibold text-danger">Inactive</span>{% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-text">
                            {{ team.LeadFirstName + ' ' + team.LeadLastName if team.LeadFirstName else 'N/A' }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right">
                           <a href="{{ url_for('recruiter_bp.manage_team', team_id=team.TeamID) }}" class="btn-primary" {% if not team.IsActive %}disabled aria-disabled="true"{% endif %}>Manage Team Â»</a>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right">
                           <!-- [NEW] Deactivate Button -->
                           {% if team.IsActive %}
                           <form action="{{ url_for('recruiter_bp.deactivate_team', team_id=team.TeamID) }}" method="POST" onsubmit="return confirm('Are you sure you want to deactivate \'{{ team.TeamName|e }}\'? This will un-assign all members.');">
                                <button type="submit" class="text-danger/80 hover:text-danger transition" title="Deactivate Team"><i class="bi bi-trash text-lg"></i></button>
                           </form>
                           {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="4" class="text-center py-10 text-text-muted">No teams found for this unit.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}