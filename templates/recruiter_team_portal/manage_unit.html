{% extends "recruiter_team_portal/recruiter_base.html" %}

{% block recruiter_title %}{{ title }}{% endblock %}

{% block recruiter_page_title_icon %}
<i class="bi bi-collection-fill text-2xl text-primary"></i>
{% endblock %}

{% block recruiter_page_title %}
{{ title }}
{% endblock %}

{% block recruiter_content %}
<div x-data="{ createTeamModal: false }">
    <!-- Header with Action Buttons -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <a href="{{ url_for('organization_bp.list_units') }}" class="btn btn-secondary-outline text-sm">
                <i class="bi bi-arrow-left"></i> Back to All Units
            </a>
            <a href="{{ url_for('organization_bp.manage_unit', unit_id=unit.UnitID, show_all=not show_all) }}" class="btn btn-secondary text-sm ml-2">
                <i class="bi bi-eye{{ '-slash' if show_all else '' }}"></i>
                {{ 'Show Active Only' if show_all else 'Show All Teams' }}
            </a>
        </div>
        <button @click="createTeamModal = true" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Create New Team
        </button>
    </div>

    <!-- Teams List in this Unit -->
    <div class="bg-card shadow-md rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-border">
                <thead class="bg-background-alt">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider">Team Name</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider">Team Lead</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider">Status</th>
                        <th scope="col" class="relative px-6 py-3"><span class="sr-only">Actions</span></th>
                    </tr>
                </thead>
                <tbody class="bg-card divide-y divide-border">
                    {% for team in teams_in_unit %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <a href="{{ url_for('organization_bp.manage_team', team_id=team.TeamID) }}" class="font-medium text-primary hover:text-primary-darker">
                                {{ team.TeamName }}
                            </a>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-text">
                            {{ team.LeadFirstName + ' ' + team.LeadLastName if team.LeadFirstName else 'N/A' }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if team.IsActive %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-alert-success-bg text-alert-success-text">Active</span>
                            {% else %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-alert-danger-bg text-alert-danger-text">Inactive</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                             <a href="{{ url_for('organization_bp.manage_team', team_id=team.TeamID) }}" class="btn btn-secondary btn-sm"><i class="bi bi-pencil"></i> Manage Team</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="text-center py-10 text-text-muted">No teams found in this unit.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Create Team Modal -->
    <div x-show="createTeamModal" class="fixed z-10 inset-0 overflow-y-auto" style="display: none;">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div x-show="createTeamModal" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="fixed inset-0 transition-opacity" @click="createTeamModal = false">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen">â€‹</span>
            <div x-show="createTeamModal" x-transition class="inline-block align-bottom bg-card rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <form action="{{ url_for('organization_bp.create_team') }}" method="POST">
                    <input type="hidden" name="unit_id" value="{{ unit.UnitID }}">
                    <div class="bg-card px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <h3 class="text-lg leading-6 font-medium text-heading">Create New Team in {{ unit.UnitName }}</h3>
                        <div class="mt-4">
                            <label for="team_name" class="block text-sm font-medium text-text-muted">Team Name</label>
                            <input type="text" name="team_name" id="team_name" class="input mt-1 block w-full" required>
                        </div>
                    </div>
                    <div class="bg-background-alt px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="submit" class="btn btn-primary w-full sm:ml-3 sm:w-auto">Create Team</button>
                        <button type="button" @click="createTeamModal = false" class="btn btn-secondary mt-3 w-full sm:mt-0 sm:w-auto">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}