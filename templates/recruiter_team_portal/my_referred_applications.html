{# templates/recruiter_team_portal/my_referred_applications.html #}
{% extends "recruiter_team_portal/recruiter_base.html" %}

{% block recruiter_title %}{{ title }}{% endblock %}
{% block recruiter_page_title %}<i class="bi bi-card-list text-text-muted"></i><span>{{ title }}</span>{% endblock %}

{% block recruiter_content %}
<div class="px-1 mb-6">
    <p class="mt-1 text-sm text-text-muted">A complete history of all job applications submitted using your referral code.</p>
</div>

<div x-data="{ isModalOpen: false, modalContentUrl: '', openModal(applicationId) { let urlTemplate = `{{ url_for('jobs_bp.review_referred_application', application_id=999999) }}`; this.modalContentUrl = urlTemplate.replace('999999', applicationId); this.isModalOpen = true; } }" x-on:keydown.escape.window="isModalOpen = false">
    
    <div class="hidden md:block bg-card rounded-lg shadow border border-border overflow-hidden">
        <table class="min-w-full text-sm divide-y divide-border">
            <thead class="bg-background">
                <tr>
                    <th class="py-3.5 pl-4 pr-3 text-left text-xs font-medium uppercase tracking-wider text-text-muted sm:pl-6">Candidate</th>
                    <th class="px-3 py-3.5 text-left text-xs font-medium uppercase tracking-wider text-text-muted">Applied For</th>
                    <th class="px-3 py-3.5 text-left text-xs font-medium uppercase tracking-wider text-text-muted">Date</th>
                    <th class="px-3 py-3.5 text-left text-xs font-medium uppercase tracking-wider text-text-muted">Status</th>
                    <th class="relative py-3.5 pl-3 pr-4 sm:pr-6"><span class="sr-only">Actions</span></th>
                </tr>
            </thead>
            <tbody class="divide-y divide-border">
                {% for app in applications %}
                <tr class="hover:bg-background/50">
                    <td class="whitespace-nowrap py-4 pl-4 pr-3 sm:pl-6">
                        <div class="flex items-center"><div class="h-10 w-10 flex-shrink-0"><img class="h-10 w-10 rounded-full object-cover" src="{{ app.ProfilePictureURL or url_for('static', filename='images/default-profile.png') }}" alt=""></div><div class="ml-4"><div class="font-medium text-heading">{{ app.FirstName }} {{ app.LastName }}</div><div class="text-text-muted">{{ app.Email }}</div></div></div>
                    </td>
                    <td class="whitespace-nowrap px-3 py-4 text-text"><div class="font-medium text-heading">{{ app.JobTitle }}</div><div class="text-text-muted">{{ app.CompanyName }}</div></td>
                    <td class="whitespace-nowrap px-3 py-4 text-text-muted">{{ app.ApplicationDate.strftime('%d %b, %Y') if app.ApplicationDate else 'N/A' }}</td>
                    <td class="whitespace-nowrap px-3 py-4">
                        {% set status_classes = {'Applied': 'bg-blue-100 text-blue-700 ring-blue-600/20 dark:bg-sky-900/50 dark:text-sky-300', 'Submitted': 'bg-blue-100 text-blue-700 ring-blue-600/20 dark:bg-sky-900/50 dark:text-sky-300', 'Shortlisted': 'bg-purple-100 text-purple-700 ring-purple-600/20 dark:bg-purple-900/50 dark:text-purple-300', 'Hired': 'bg-green-100 text-green-700 ring-green-600/20 dark:bg-green-900/50 dark:text-green-300', 'Rejected': 'bg-red-100 text-red-700 ring-red-600/20 dark:bg-red-900/50 dark:text-red-300'} %}
                        <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset {{ status_classes.get(app.Status, 'bg-slate-100 text-slate-600 ring-slate-500/10 dark:bg-slate-700 dark:text-slate-200') }}">{{ app.Status }}</span>
                    </td>
                    <td class="relative whitespace-nowrap py-4 pl-3 pr-4 text-right font-medium sm:pr-6"><button @click="openModal({{ app.ApplicationID }})" type="button" class="text-primary hover:underline">Review</button></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="md:hidden space-y-4">
        {% for app in applications %}
        <div class="bg-card p-4 rounded-lg shadow border border-border">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img class="h-10 w-10 rounded-full object-cover" src="{{ app.ProfilePictureURL or url_for('static', filename='images/default-profile.png') }}" alt="">
                    <div>
                        <div class="font-medium text-heading">{{ app.FirstName }} {{ app.LastName }}</div>
                        <div class="text-xs text-text-muted">{{ app.Email }}</div>
                    </div>
                </div>
                <button @click="openModal({{ app.ApplicationID }})" type="button" class="btn-secondary text-xs">Review</button>
            </div>
            <div class="mt-4 border-t border-border pt-4 space-y-2 text-sm">
                <div class="flex justify-between"><span class="text-text-muted">Job:</span> <span class="font-medium text-right text-text">{{ app.JobTitle }} at {{ app.CompanyName }}</span></div>
                <div class="flex justify-between"><span class="text-text-muted">Date:</span> <span class="text-text-muted">{{ app.ApplicationDate.strftime('%d %b, %Y') if app.ApplicationDate else 'N/A' }}</span></div>
                <div class="flex justify-between items-center">
                    <span class="text-text-muted">Status:</span>
                    {% set status_classes = {'Applied': 'bg-blue-100 text-blue-700 ring-blue-600/20 dark:bg-sky-900/50 dark:text-sky-300', 'Submitted': 'bg-blue-100 text-blue-700 ring-blue-600/20 dark:bg-sky-900/50 dark:text-sky-300', 'Shortlisted': 'bg-purple-100 text-purple-700 ring-purple-600/20 dark:bg-purple-900/50 dark:text-purple-300', 'Hired': 'bg-green-100 text-green-700 ring-green-600/20 dark:bg-green-900/50 dark:text-green-300', 'Rejected': 'bg-red-100 text-red-700 ring-red-600/20 dark:bg-red-900/50 dark:text-red-300'} %}
                    <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset {{ status_classes.get(app.Status, 'bg-slate-100 text-slate-600 ring-slate-500/10 dark:bg-slate-700 dark:text-slate-200') }}">{{ app.Status }}</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if not applications %}
        <div class="text-center py-16 text-text-muted bg-card rounded-lg shadow border border-border">
            <i class="bi bi-folder-x text-5xl text-border"></i>
            <p class="mt-2">No applications have been submitted with your referral code yet.</p>
        </div>
    {% endif %}

    <div x-show="isModalOpen" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="relative z-50" style="display: none;">
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div x-show="isModalOpen" x-transition @click.away="isModalOpen = false" class="relative transform overflow-hidden rounded-lg bg-background text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl">
                    <iframe :src="isModalOpen ? modalContentUrl : ''" class="w-full h-[80vh] rounded-lg" frameborder="0"></iframe>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}