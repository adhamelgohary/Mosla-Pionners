{# templates/account_manager_portal/application_review_modal.html #}
{% extends "base_empty.html" %}

{% block title %}Review Application{% endblock %}

{% block content %}
<div class="bg-gray-50">
    <!-- Modal Header -->
    <div class="sticky top-0 z-10 bg-gray-50/70 p-4 sm:p-6 backdrop-blur-sm border-b border-gray-200">
        <h2 class="text-xl font-bold text-gray-900">{{ review_data.candidate_profile.FirstName }} {{ review_data.candidate_profile.LastName }}</h2>
        <p class="text-sm text-gray-600">
            Application for <span class="font-semibold">{{ review_data.application.OfferTitle }}</span>
        </p>
    </div>

    <div class="p-4 sm:p-6 space-y-6">
        <!-- Section: Application Materials -->
        <div>
            <h3 class="text-lg font-medium text-gray-900">Application Materials</h3>
            <div class="mt-4 space-y-6">
                <div class="bg-white p-4 rounded-lg shadow-sm border">
                    <h4 class="font-semibold text-gray-800 mb-2">Candidate's Motivation</h4>
                    <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ review_data.application.NotesByCandidate or 'No answer provided.' }}</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm border">
                        <h4 class="font-semibold text-gray-800 mb-3">Submitted CV</h4>
                        {% if review_data.cv %}
                            <a href="{{ url_for('static', filename=review_data.cv.CVFileUrl) }}" target="_blank" class="flex items-center gap-3 p-3 bg-gray-50 hover:bg-indigo-50 rounded-md border border-gray-200">
                                <i class="bi bi-file-earmark-pdf-fill text-2xl text-red-500"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">{{ review_data.cv.CVTitle or review_data.cv.OriginalFileName }}</p>
                                    <p class="text-xs text-gray-500">Click to view in new tab</p>
                                </div>
                            </a>
                        {% else %}
                            <p class="text-sm text-gray-500 italic">No CV found for this application.</p>
                        {% endif %}
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border">
                        <h4 class="font-semibold text-gray-800 mb-3">Voice Introduction</h4>
                        {% if review_data.voice_note %}
                            <audio controls class="w-full"><source src="{{ url_for('static', filename=review_data.voice_note.VoiceNoteURL) }}"></audio>
                        {% else %}
                            <p class="text-sm text-gray-500 italic">No voice note found for this application.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Section: Full Candidate Profile -->
        <div>
            <h3 class="text-lg font-medium text-gray-900">Candidate Profile Details</h3>
            <div class="mt-4 bg-white p-4 rounded-lg shadow-sm border">
                <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 text-sm">
                    {% set profile = review_data.candidate_profile %}
                    <div><dt class="font-medium text-gray-500">Full Name</dt><dd class="mt-1 text-gray-900">{{ profile.FirstName }} {{ profile.LastName }}</dd></div>
                    <div><dt class="font-medium text-gray-500">Email Address</dt><dd class="mt-1 text-gray-900">{{ profile.Email }}</dd></div>
                    <div><dt class="font-medium text-gray-500">Phone</dt><dd class="mt-1 text-gray-900">{{ profile.PhoneNumber or 'N/A' }}</dd></div>
                    <div><dt class="font-medium text-gray-500">Date of Birth</dt><dd class="mt-1 text-gray-900">{{ profile.DateOfBirth.strftime('%d %B %Y') if profile.DateOfBirth else 'N/A' }}</dd></div>
                    <div><dt class="font-medium text-gray-500">Nationality</dt><dd class="mt-1 text-gray-900">{{ profile.Nationality or 'N/A' }}</dd></div>
                    <div><dt class="font-medium text-gray-500">Educational Status</dt><dd class="mt-1 text-gray-900">{{ profile.EducationalStatus or 'N/A' }}</dd></div>
                </dl>
            </div>
        </div>
    </div>

    <!-- Modal Footer with Decision Form (Sticky) -->
    <div class="sticky bottom-0 z-10 bg-gray-50/70 p-4 backdrop-blur-sm border-t border-gray-200">
        <form id="decisionForm" method="POST" action="{{ url_for('account_manager_bp.update_application_status', application_id=review_data.application.ApplicationID) }}">
            <input type="hidden" name="manager_staff_id" value="{{ manager_staff_id }}">
            <input type="hidden" name="offer_id" value="{{ review_data.application.OfferID }}">
            <input type="hidden" name="action" id="decisionAction">

            <div>
                <label for="feedback_notes" class="block text-sm font-medium leading-6 text-gray-900">Feedback / Notes for Decision</label>
                <div class="mt-2">
                    <textarea rows="3" name="feedback_notes" id="feedback_notes" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"></textarea>
                </div>
                <p class="mt-2 text-xs text-gray-500">This feedback will be saved to the application record.</p>
            </div>
            
            <div class="mt-4 flex justify-end items-center gap-3">
                <button type="submit" @click="document.getElementById('decisionAction').value = 'reject'" class="rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">Reject</button>
                <button type="submit" @click="document.getElementById('decisionAction').value = 'approve'" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">Shortlist</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}