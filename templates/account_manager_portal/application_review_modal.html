{# templates/account_manager_portal/application_review_modal.html #}
{% extends "base_empty.html" %}

{% block title %}Review Application{% endblock %}

{% block content %}
<div class="p-6 bg-gray-50">
    <div class="space-y-6">
        <!-- Header -->
        <div>
            <h2 class="text-xl font-bold text-gray-900">{{ application.info.FirstName }} {{ application.info.LastName }}</h2>
            <p class="text-sm text-gray-600">
                Application for <span class="font-semibold">{{ application.info.OfferTitle }}</span>
            </p>
        </div>

        <!-- Application Details -->
        <div class="bg-white p-4 rounded-lg shadow-sm border">
            <h3 class="font-semibold text-gray-800 mb-2">Candidate's Motivation</h3>
            <p class="text-sm text-gray-700 whitespace-pre-wrap">{{ application.info.NotesByCandidate or 'No answer provided.' }}</p>
        </div>

        <!-- Submitted Materials -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- CV Card -->
            <div class="bg-white p-4 rounded-lg shadow-sm border">
                <h3 class="font-semibold text-gray-800 mb-3">Submitted CV</h3>
                {% if application.cv %}
                    <a href="{{ url_for('static', filename=application.cv.CVFileUrl) }}" target="_blank"
                       class="flex items-center gap-3 p-3 bg-gray-50 hover:bg-indigo-50 rounded-md border border-gray-200">
                        <i class="bi bi-file-earmark-pdf-fill text-2xl text-red-500"></i>
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ application.cv.CVTitle or application.cv.OriginalFileName }}</p>
                            <p class="text-xs text-gray-500">Click to view in new tab</p>
                        </div>
                    </a>
                {% else %}
                    <p class="text-sm text-gray-500 italic">No CV found for this application.</p>
                {% endif %}
            </div>
            <!-- Voice Note Card -->
            <div class="bg-white p-4 rounded-lg shadow-sm border">
                <h3 class="font-semibold text-gray-800 mb-3">Voice Introduction</h3>
                {% if application.voice_note %}
                    <audio controls class="w-full">
                        <source src="{{ url_for('static', filename=application.voice_note.VoiceNoteURL) }}" type="audio/webm">
                        Your browser does not support the audio element.
                    </audio>
                {% else %}
                    <p class="text-sm text-gray-500 italic">No voice note found for this application.</p>
                {% endif %}
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="pt-6 border-t flex justify-end items-center gap-3">
            <p class="text-sm text-gray-600 mr-auto">Decision:</p>
            <form method="POST" action="{{ url_for('account_manager_bp.update_application_status', application_id=application.info.ApplicationID) }}">
                <input type="hidden" name="manager_staff_id" value="{{ manager_staff_id }}">
                <input type="hidden" name="offer_id" value="{{ application.info.OfferID }}">
                <input type="hidden" name="action" value="reject">
                <button type="submit" class="rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">Reject</button>
            </form>
            <form method="POST" action="{{ url_for('account_manager_bp.update_application_status', application_id=application.info.ApplicationID) }}">
                <input type="hidden" name="manager_staff_id" value="{{ manager_staff_id }}">
                <input type="hidden" name="offer_id" value="{{ application.info.OfferID }}">
                <input type="hidden" name="action" value="approve">
                <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">Shortlist</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}